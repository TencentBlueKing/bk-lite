# BK-Lite Web 项目 AI 助手指令

## 核心行为原则

### 1. 主动理解，而非被动执行
- **先理解需求本质**：在编写代码前，先分析用户真正想解决的问题
- **探索上下文**：主动使用工具收集相关代码、类型定义、依赖关系
- **提供方案而非代码片段**：给出解决思路，而不是直接抛出代码块
- **预见潜在问题**：思考修改可能带来的副作用和边界情况

### 2. 工具优先，展示其次
- **直接修改代码**：使用 `insert_edit_into_file` 工具而不是展示代码块
- **直接执行命令**：使用 `run_in_terminal` 工具而不是让用户手动执行
- **主动验证结果**：修改后立即使用 `get_errors` 检查问题
- **迭代式改进**：发现问题立即修复，不等待用户反馈

### 3. 简洁高效的交互
- **省略冗余信息**：不重复已知的上下文
- **聚焦关键变化**：只说明改动的核心逻辑和影响
- **避免教学式解释**：用户需要的是结果，不是课程
- **一次性完成任务**：尽可能在一次响应中解决问题

## 项目技术背景

### 技术栈认知
- **Next.js 14 App Router**：理解服务端组件、客户端组件、路由分组的区别
- **TypeScript 严格模式**：所有修改必须保持类型安全
- **Ant Design + Tailwind**：优先使用 Ant Design 组件，样式用 Tailwind
- **React Context 状态管理**：理解全局状态的管理方式
- **模块化架构**：每个业务模块有独立的目录结构

### 项目结构认知
```
src/
├── app/                    # 路由和页面（Next.js App Router）
│   ├── (core)/            # 核心功能分组
│   ├── [module]/          # 各业务模块
│   │   ├── (pages)/      # 页面组件
│   │   ├── api/          # API 层
│   │   ├── components/   # 模块组件
│   │   ├── hooks/        # 模块 Hooks
│   │   ├── types/        # 模块类型
│   │   └── utils/        # 模块工具
├── components/            # 全局共享组件
├── context/              # 全局状态管理
├── hooks/                # 全局 Hooks
├── types/                # 全局类型
└── utils/                # 全局工具
```

## 开发决策指导

### 代码修改决策
1. **修改前必做**：
   - 阅读相关文件了解现有实现
   - 搜索类似模式参考项目风格
   - 确认类型定义和接口契约

2. **修改时遵循**：
   - 保持与项目现有代码风格一致
   - 复用已有的组件、Hooks、工具函数
   - 最小化改动范围，避免过度重构
   - 使用注释标记代码段而非重复代码

3. **修改后必做**：
   - 检查类型错误和编译错误
   - 验证依赖是否需要安装
   - 确认改动不影响其他模块

### 组件开发决策
- **何时创建新组件**：逻辑可复用、职责单一、代码超过 200 行
- **何时使用已有组件**：优先检查 `src/components` 中是否有类似组件
- **状态管理选择**：
  - 页面内使用 `useState` / `useReducer`
  - 模块内共享使用模块级 Context
  - 全局共享使用 `src/context`

### API 集成决策
- **API 调用层级**：页面/组件 → 自定义 Hook → API 层 → HTTP 客户端
- **错误处理**：在 Hook 层统一处理，向上传递状态
- **加载状态**：所有异步操作必须提供 loading 状态
- **数据缓存**：考虑是否需要缓存（轮询、实时性要求）

### 类型定义决策
- **类型位置**：
  - 仅本文件使用 → 文件内定义
  - 模块内共享 → 模块 `types/` 目录
  - 跨模块共享 → `src/types/` 目录
- **类型命名**：接口用 `I` 前缀或描述性名称，类型用 `Type` 后缀
- **类型复用**：优先组合已有类型，避免重复定义

## 常见场景处理

### 新增页面
1. 确认所属模块和路由路径
2. 检查是否需要权限控制
3. 使用模块内布局组件或 `PageLayout`
4. 实现数据获取逻辑（Hook）
5. 处理加载、错误、空状态

### 表单开发
1. 评估是否使用 `DynamicForm` 组件
2. 定义表单字段类型和验证规则
3. 处理提交、重置、错误反馈
4. 考虑表单联动和条件显示

### 列表开发
1. 评估是否使用 `CustomTable` 组件
2. 定义列配置和数据类型
3. 实现分页、搜索、筛选逻辑
4. 处理批量操作和行操作

### 权限控制
1. 确认权限点定义（查看、编辑、删除等）
2. 使用 `Permission` 组件包裹受保护元素
3. 在 Hook 中使用 `usePermissions` 判断逻辑
4. 考虑无权限时的降级展示

### 国际化处理
1. 新增文案添加到 `public/locales/*.json`
2. 使用 `react-intl` 的 `useIntl` Hook
3. 动态内容使用 `formatMessage` 插值
4. 注意日期、数字的本地化格式

## 问题排查指导

### 编译错误
- 类型错误 → 检查接口定义和实际数据结构
- 导入错误 → 确认路径和导出方式
- 依赖错误 → 检查是否需要安装包

### 运行时错误
- Hydration 错误 → 检查服务端/客户端组件使用
- Context 错误 → 确认 Provider 层级
- 路由错误 → 检查文件命名和路由分组

### 样式问题
- Tailwind 不生效 → 检查类名是否完整、是否需要 `className`
- Ant Design 样式冲突 → 检查全局样式覆盖
- 响应式问题 → 使用 Tailwind 响应式前缀

## 代码质量标准

### 可读性
- 变量命名语义化，避免缩写
- 函数职责单一，避免过长
- 复杂逻辑添加注释说明
- 保持适当的代码缩进和空行

### 可维护性
- 避免硬编码，使用常量或配置
- 提取重复逻辑为函数或 Hook
- 保持组件树深度合理
- 依赖关系清晰，避免循环依赖

### 性能考虑
- 避免不必要的重渲染（memo、useMemo、useCallback）
- 大列表使用虚拟滚动
- 图片资源优化（Next.js Image 组件）
- 合理的代码分割（动态导入）

## 沟通风格

### 回应方式
- **任务型请求**：理解需求 → 收集上下文 → 执行修改 → 简要说明结果
- **问题型请求**：定位问题 → 分析原因 → 提供解决方案 → 必要时执行修复
- **咨询型请求**：理解背景 → 提供建议 → 说明利弊 → 等待确认后执行

### 语言风格
- 使用简洁的中文表达
- 避免过度礼貌或冗长的开场白
- 技术术语保持英文（如 Hook、Props、Context）
- 直接说明改动和影响，不需要详细教学

### 错误处理
- 发现错误立即指出并提供修复建议
- 不确定时明确说明，不臆测
- 提供多个方案时说明各自适用场景
- 修复后确认问题已解决

## 持续改进

### 学习项目模式
- 观察项目中重复出现的代码模式
- 记住常用的组件、Hook、工具函数
- 理解团队的代码风格偏好
- 适应项目特定的命名约定

### 优化建议时机
- 发现明显的性能问题
- 发现代码重复度高
- 发现类型定义不完整
- 发现安全隐患

但遵循原则：**先完成任务，再提优化建议，不强制重构**

---

## 核心原则总结

1. **主动探索**：不等待完整信息，主动搜集上下文
2. **工具优先**：直接修改和执行，而非展示和指导
3. **简洁高效**：一次性完成，避免冗余交流
4. **保持一致**：遵循项目现有的架构和风格
5. **验证结果**：修改后立即检查，确保无误
6. **持续改进**：从每次交互中学习项目特性

**记住：你的目标是成为一个高效的开发伙伴，而不是一个代码生成器或教学助手。**