---
applyTo: '**'
---
# 代码与接口风格
* 风格对齐：遵循仓库现有风格指南与命名规则；命名语义清晰，避免模糊缩写。
* 可读性优先：鼓励早返回、减少嵌套；更重可维护性而非微小性能优化。
* 接口契约：公共接口与复杂路径必须提供清晰的类型/契约/Schema描述（以本仓库采用的任何等价机制为准）。
* 注释与文档：与项目既有注释/文档风格一致，说明输入、输出、边界与失败场景。
* 性能标记：性能敏感路径接入项目内置的计时/指标采集钩子（使用既有机制，不自创）。
* 整洁维护：函数单一职责、避免魔法数、避免隐式副作用，保证可理解和可演进，遵循代码整洁之道

# 日志与错误处理
* 统一日志入口：只使用仓库提供的日志接口（不要自造输出通道）。
* 关键日志点：入口、外部调用、异常处理、状态变更处必须记录。
* 安全与隐私：禁止输出敏感信息；仅展示参数概要（掩码/哈希）。
* 异常策略：不得吞异常；顶层捕获需输出上下文（关联 ID、关键参数摘要、下游调用概览），保证可观测性。

# 依赖与配置
* 依赖白名单：仅使用仓库依赖清单/锁文件中允许的依赖。
* 新增依赖：在 PR 中阐明用途、必要性与权衡；默认拒绝非必要引入。
* 统一配置：通过环境变量/集中配置系统管理；在示例清单中补足样例项。
* 密钥管理：不得提交默认密钥或敏感配置到仓库。
* 运行环境：遵循仓库提供的隔离化运行环境与脚本，不依赖系统全局环境。

# I/O 与请求处理（框架无关）
* 非阻塞 I/O：外部调用应为异步或等价非阻塞实现，并设置超时与可取消机制。
* 参数校验：所有入口参数使用Schema/契约校验，与仓库既有实践一致。
* 鉴权与权限：统一由中间件/拦截器实现，最小权限原则，支持令牌过期与刷新。
* CPU 密集：交由后台任务/队列处理，不得阻塞主执行线程/事件循环。

# 稳定性、性能与安全
* 超时与退避：外部依赖调用必须具备超时 + 指数退避重试（含上限与熔断条件）。
* 输入/输出安全：输入必校验，输出需安全编码；防注入、目录遍历、越权访问。
* 资源控制：为高耗时/高并发路径设置并发上限、节流与隔离；关键路径具备指标与追踪。

# 交付与变更控制
* 可读性：代码清晰、与现有风格一致。
* 可测试性：变更具备可被现有测试/集成流程覆盖的条件。
* 可回滚性：边界清楚、依赖解耦，便于快速撤销。
* 可观测性：关键路径具备日志、计时与必要监控点。

测试约束（重要）
* 不要生成新的单元测试文件。
* 代码生成过程中，如需快速验证，仅可使用项目现有的一行式运行器/脚本入口做临时校验（例如通过已有 CLI/解释器的 -c '…' 或等价方式），不落地新文件、不中断既有测试结构。