{
  "plugin": "MSSQL",
  "plugin_desc": "MSSQL Exporter is used to collect and export metrics from Microsoft SQL Server databases, including query performance, connection counts, transaction statistics, and resource usage, to help monitor the health and performance of MSSQL instances.",
  "status_query": "any({instance_type='mssql', collect_type='database'}) by (instance_id)",
  "name": "MSSQL",
  "icon": "msSql",
  "type": "Database",
  "description": "",
  "default_metric": "any({instance_type='mssql'}) by (instance_id)",
  "instance_id_keys": ["instance_id"],
  "supplementary_indicators": ["sqlserver_database_io_read_latency_ms", "sqlserver_waitstats_wait_time_ms_rate", "sqlserver_volume_space_available_space_bytes"],
  "metrics": [
    {
      "metric_group": "Base",
      "name": "sqlserver_cpu_sqlserver_process_cpu_avg",
      "display_name": "MSSQL Process CPU Usage",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "percent",
      "dimensions": [],
      "description": "CPU usage by the SQL Server database process, directly reflecting database computational load. Sustained high values may indicate queries need optimization or resource bottlenecks exist.",
      "query": "avg_over_time(sqlserver_cpu_sqlserver_process_cpu{__$labels__}[5m])"
    },
    {
      "metric_group": "Base",
      "name": "sqlserver_cpu_system_idle_cpu_avg",
      "display_name": "System Idle CPU",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "percent",
      "dimensions": [],
      "description": "Overall operating system idle CPU percentage, indicating total CPU resource utilization. Low values indicate CPU resource constraints that may affect system stability.",
      "query": "avg_over_time(sqlserver_cpu_system_idle_cpu{__$labels__}[5m])"
    },
    {
      "metric_group": "Base",
      "name": "sqlserver_server_properties_uptime",
      "display_name": "Uptime",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "s",
      "dimensions": [],
      "description": "Duration since last SQL Server instance startup, monitoring instance stability. Long uptime may require a restart to free memory and clean up resources.",
      "query": "sqlserver_server_properties_uptime{__$labels__}"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_database_io_read_latency_ms",
      "display_name": "Database Read Latency",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Average latency time for database file read operations, reflecting storage subsystem performance. High latency may indicate storage bottlenecks, network issues, or insufficient hardware performance.",
      "query": "avg_over_time(sqlserver_database_io_read_latency_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_database_io_write_latency_ms",
      "display_name": "Database Write Latency",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Average latency time for database file write operations, directly impacting transaction performance and application response times. High latency may affect data write speed and system throughput.",
      "query": "avg_over_time(sqlserver_database_io_write_latency_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_database_io_reads_rate",
      "display_name": "Database Read Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Rate of database file read operations, indicating data retrieval load intensity and working set access patterns. High read rates may indicate frequent queries or low cache efficiency.",
      "query": "rate(sqlserver_database_io_reads{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_database_io_writes_rate",
      "display_name": "Database Write Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Rate of database file write operations, indicating data write load intensity and transaction activity levels. High write rates may indicate substantial data updates or insert operations.",
      "query": "rate(sqlserver_database_io_writes{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_memory_clerks_size_kb",
      "display_name": "Memory Clerk Size",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "kibibytes",
      "dimensions": [],
      "description": "Current memory size allocated by SQL Server internal memory clerks, used to analyze memory usage distribution and identify potential memory leaks. Different clerks represent different memory usage purposes.",
      "query": "sqlserver_memory_clerks_size_kb{__$labels__}"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_performance_value_rate",
      "display_name": "Batch Requests Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Rate of batch requests processed by SQL Server, measuring overall database throughput and load pressure. High request rates indicate the database is processing a large volume of queries.",
      "query": "rate(sqlserver_performance_value{counter=~\"Batch Requests/sec\", __$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_page_life_expectancy",
      "display_name": "Page Life Expectancy",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "s",
      "dimensions": [],
      "description": "Average time data pages stay in the buffer pool, reflecting memory pressure. Low values suggest insufficient memory, potentially causing frequent physical I/O and impacting performance.",
      "query": "sqlserver_performance_value{counter=\"Page life expectancy\", __$labels__}"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_buffer_cache_hit_ratio",
      "display_name": "Buffer Cache Hit Ratio",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "percent",
      "dimensions": [],
      "description": "Percentage of data page reads satisfied from the buffer pool, reflecting memory efficiency. High hit ratios indicate most data requests are served from memory, suggesting good performance. Low hit ratios may indicate a need for more memory.",
      "query": "sqlserver_performance_value{counter=\"Buffer cache hit ratio\", __$labels__}"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_user_connections_rate",
      "display_name": "User Connections",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of users currently connected to the SQL Server instance, reflecting concurrent load and connection pool usage. Too many connections may lead to resource contention.",
      "query": "rate(sqlserver_performance_value{counter=~\"User Connections\", __$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_lock_wait_time_rate",
      "display_name": "Lock Wait Time",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of lock wait time, reflecting concurrency contention. High values may indicate blocking or lock contention issues that require transaction design optimization.",
      "query": "rate(sqlserver_performance_value{counter=~\"Lock Waits/sec\", __$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_requests_cpu_time_ms_rate",
      "display_name": "Request CPU Time Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of CPU time consumed by requests, used to identify queries and statements with high CPU consumption, aiding in performance optimization and resource allocation decisions.",
      "query": "rate(sqlserver_requests_cpu_time_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_requests_logical_reads_rate",
      "display_name": "Request Logical Reads Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Rate of logical read operations by requests, reflecting query data access patterns and working set size. High logical reads may indicate queries lacking indexes or needing optimization.",
      "query": "rate(sqlserver_requests_logical_reads{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_requests_total_elapsed_time_ms_rate",
      "display_name": "Request Elapsed Time Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of total elapsed time of requests, monitoring query execution efficiency and response times. High elapsed time may indicate complex queries, large data volumes, or performance issues.",
      "query": "rate(sqlserver_requests_total_elapsed_time_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_requests_wait_time_ms_rate",
      "display_name": "Request Wait Time Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of wait time of requests, reflecting query waiting on resources. High wait times may indicate resource bottlenecks or lock contention.",
      "query": "rate(sqlserver_requests_wait_time_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_schedulers_active_workers_count",
      "display_name": "Scheduler Active Workers Count",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of active workers currently executing tasks on schedulers, reflecting CPU scheduling load. Excessive numbers may indicate high CPU pressure or parallel query contention.",
      "query": "sqlserver_schedulers_active_workers_count{__$labels__}"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_schedulers_runnable_tasks_count",
      "display_name": "Scheduler Runnable Tasks Count",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of tasks ready to run and waiting for CPU execution on schedulers, reflecting CPU queue length. High values indicate insufficient CPU resources or a large number of concurrent requests.",
      "query": "sqlserver_schedulers_runnable_tasks_count{__$labels__}"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_waitstats_resource_wait_ms",
      "display_name": "Resource Wait Time Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of time spent waiting for external resources (such as disk, network, memory), reflecting true resource bottlenecks. Helps identify hardware limitations like I/O, memory, or network.",
      "query": "rate(sqlserver_waitstats_resource_wait_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_waitstats_signal_wait_time_ms_rate",
      "display_name": "Signal Wait Time Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of time spent waiting for CPU scheduler, reflecting CPU pressure. High signal wait time indicates CPU resource contention or parallel query issues, requiring query optimization or additional CPU resources.",
      "query": "rate(sqlserver_waitstats_signal_wait_time_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_waitstats_wait_time_ms_rate",
      "display_name": "Wait Time Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Rate of cumulative wait time for various wait types in SQL Server, a key metric for performance tuning that helps identify system bottlenecks.",
      "query": "rate(sqlserver_waitstats_wait_time_ms{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance",
      "name": "sqlserver_waitstats_waiting_tasks_count",
      "display_name": "Waiting Tasks Count",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of SQL Server tasks currently waiting, reflecting the system's concurrent wait situation. High waiting tasks count may indicate resource contention in the system.",
      "query": "sqlserver_waitstats_waiting_tasks_count{__$labels__}"
    },
    {
      "metric_group": "Storage",
      "name": "sqlserver_volume_space_available_space_bytes",
      "display_name": "Volume Available Space",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "bytes",
      "dimensions": [],
      "description": "Available space on storage volumes, monitoring disk space usage. Insufficient space may cause database operation failures or performance degradation.",
      "query": "sqlserver_volume_space_available_space_bytes{__$labels__}"
    },
    {
      "metric_group": "Storage",
      "name": "sqlserver_volume_space_total_space_bytes",
      "display_name": "Volume Total Space",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "bytes",
      "dimensions": [],
      "description": "Total space on storage volumes, used to calculate disk usage and plan storage expansion.",
      "query": "sqlserver_volume_space_total_space_bytes{__$labels__}"
    },
    {
      "metric_group": "Storage",
      "name": "sqlserver_volume_space_used_space_bytes",
      "display_name": "Volume Used Space",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "bytes",
      "dimensions": [],
      "description": "Used space on storage volumes, combined with total space to calculate usage rate and monitor storage growth trends.",
      "query": "sqlserver_volume_space_used_space_bytes{__$labels__}"
    }
  ]
}