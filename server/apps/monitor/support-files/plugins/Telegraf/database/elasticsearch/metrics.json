{
  "plugin": "ElasticSearch",
  "plugin_desc": "By collecting Elasticsearch file system metrics, HTTP requests, IO statistics, document statistics, query cache, and circuit breaker metrics, this plugin helps users monitor the health and performance of their cluster.",
  "status_query": "any({instance_type='elasticsearch', collect_type='database'}) by (instance_id)",
  "name": "ElasticSearch",
  "icon": "elasticsearch-Elasticsearch",
  "type": "Database",
  "description": "",
  "default_metric": "any({instance_type='elasticsearch'}) by (instance_id)",
  "instance_id_keys": ["instance_id"],
  "supplementary_indicators": ["elasticsearch_cluster_health_status_code", "elasticsearch_cluster_health_active_primary_shards", "elasticsearch_cluster_health_unassigned_shards"],
  "metrics": [
    {
      "metric_group": "Base",
      "name": "elasticsearch_cluster_health_status_code",
      "display_name": "Cluster Health Status",
      "instance_id_keys": ["instance_id"],
      "data_type": "Enum",
      "unit": "[{\"name\":\"正常\",\"id\":1,\"color\":\"#1ac44a\"},{\"name\":\"警告\",\"id\":2,\"color\":\"#faad14\"},{\"name\":\"严重\",\"id\":3,\"color\":\"#ff4d4f\"}]",
      "dimensions": [],
      "description": "Core cluster health metric, reflects cluster health via status values: 1=normal (green), 2=replica missing, 3=primary missing (failure); red status impacts data availability",
      "query": "elasticsearch_cluster_health_status_code{__$labels__}"
    },
    {
      "metric_group": "Base",
      "name": "elasticsearch_cluster_health_active_primary_shards",
      "display_name": "Active Primary Shards",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "short",
      "dimensions": [],
      "description": "Core data availability metric, represents the count of active primary shards; missing primary shards block data read/write; ensure consistency with expected count",
      "query": "elasticsearch_cluster_health_active_primary_shards{__$labels__}"
    },
    {
      "metric_group": "Base",
      "name": "elasticsearch_cluster_health_unassigned_shards",
      "display_name": "Unassigned Shards",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "short",
      "dimensions": [],
      "description": "Core cluster anomaly indicator, represents the count of unassigned shards; investigate if >0; long-term existence reduces data redundancy and availability",
      "query": "elasticsearch_cluster_health_unassigned_shards{__$labels__}"
    },
    {
      "metric_group": "Node",
      "name": "elasticsearch_jvm_mem_heap_used_percent",
      "display_name": "JVM Heap Usage",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "percent",
      "dimensions": ["node_name"],
      "description": "Core JVM memory pressure metric, reflects JVM memory usage; high usage triggers Full GC and cluster lag",
      "query": "elasticsearch_jvm_mem_heap_used_percent{__$labels__}"
    },
    {
      "metric_group": "Node",
      "name": "elasticsearch_jvm_gc_collectors_young_collection_time_in_millis_rate",
      "display_name": "Young Gen GC Time Per Second",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "msps",
      "dimensions": ["node_name"],
      "description": "GC efficiency monitoring metric, reflects GC operation latency; sustained high values indicate high CPU usage by GC, affecting business performance",
      "query": "rate(elasticsearch_jvm_gc_collectors_young_collection_time_in_millis{__$labels__}[5m])"
    },
    {
      "metric_group": "Node",
      "name": "elasticsearch_fs_data_0_available_in_bytes",
      "display_name": "Node Available Disk Space",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "bytes",
      "dimensions": ["node_name"],
      "description": "Node storage availability metric, reflects remaining disk space on nodes; disk exhaustion causes node offline",
      "query": "elasticsearch_fs_data_0_available_in_bytes{__$labels__}"
    },
    {
      "metric_group": "Node",
      "name": "elasticsearch_process_cpu_percent",
      "display_name": "Process CPU Usage",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "percent",
      "dimensions": ["node_name"],
      "description": "Process compute load metric, reflects CPU load of the process; high load degrades cluster read/write performance",
      "query": "elasticsearch_process_cpu_percent{__$labels__}"
    },
    {
      "metric_group": "Node",
      "name": "elasticsearch_process_open_file_descriptors",
      "display_name": "Open File Descriptors",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "short",
      "dimensions": ["node_name"],
      "description": "File resource monitoring metric, reflects file descriptor usage; approaching system limits affects shard availability",
      "query": "elasticsearch_process_open_file_descriptors{__$labels__}"
    },
    {
      "metric_group": "Breaker",
      "name": "elasticsearch_breakers_fielddata_tripped_rate",
      "display_name": "Fielddata Memory Breaker Trigger Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "cps",
      "dimensions": ["node_name"],
      "description": "Memory protection mechanism monitoring, reflects triggers of the memory protection breaker; >0 indicates recent memory shortage",
      "query": "rate(elasticsearch_breakers_fielddata_tripped{__$labels__}[5m])"
    },
    {
      "metric_group": "Breaker",
      "name": "elasticsearch_breakers_request_tripped_rate",
      "display_name": "Rate of HTTP Request Circuit Breaker Triggering",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "cps",
      "dimensions": ["node_name"],
      "description": "Request-level memory protection monitoring, reflects triggers of the request-level memory protection breaker; >0 indicates recent request memory overload",
      "query": "rate(elasticsearch_breakers_request_tripped{__$labels__}[5m])"
    },
    {
      "metric_group": "HTTP",
      "name": "elasticsearch_http_current_open",
      "display_name": "HTTP Current Connections",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "short",
      "dimensions": ["node_name"],
      "description": "HTTP service availability metric, reflects connection usage of the HTTP service; approaching connection limits affects new request acceptance",
      "query": "elasticsearch_http_current_open{__$labels__}"
    },
    {
      "metric_group": "HTTP",
      "name": "elasticsearch_http_total_opened_rate",
      "display_name": "HTTP New Connections Per Second",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "cps",
      "dimensions": ["node_name"],
      "description": "HTTP service traffic metric, reflects recent business request traffic changes; aids in troubleshooting traffic peak issues",
      "query": "rate(elasticsearch_http_total_opened{__$labels__}[5m])"
    },
    {
      "metric_group": "ThreadPool",
      "name": "elasticsearch_thread_pool_index_queue",
      "display_name": "Index Thread Pool Queue Length",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "short",
      "dimensions": ["node_name"],
      "description": "Write performance warning metric, reflects the length of the write request queue; growing queue length indicates insufficient write capacity, causing latency spikes",
      "query": "elasticsearch_thread_pool_index_queue{__$labels__}"
    },
    {
      "metric_group": "ThreadPool",
      "name": "elasticsearch_thread_pool_search_queue",
      "display_name": "Search Thread Pool Queue Length",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "short",
      "dimensions": ["node_name"],
      "description": "Query performance warning metric, reflects the length of the query request queue; growing queue length indicates insufficient query capacity, affecting business experience",
      "query": "elasticsearch_thread_pool_search_queue{__$labels__}"
    }
  ]
}