{
  "plugin": "Zookeeper",
  "plugin_desc": "By collecting runtime performance data and stability metrics of Zookeeper, such as latency, connections, and node counts, users can monitor the cluster status in real-time and optimize performance.",
  "status_query": "any({instance_type='zookeeper', collect_type='middleware'}) by (instance_id)",
  "name": "Zookeeper",
  "icon": "Zookeeper",
  "type": "Middleware",
  "description": "",
  "default_metric": "any({instance_type='zookeeper'}) by (instance_id)",
  "instance_id_keys": ["instance_id"],
  "supplementary_indicators": ["zookeeper_num_alive_connections", "zookeeper_outstanding_requests", "zookeeper_avg_latency"],
  "metrics": [
    {
      "metric_group": "System Status",
      "name": "version",
      "display_name": "Version Info",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "none",
      "dimensions": [],
      "description": "Zookeeper service version identifier for software version recognition and compatibility.",
      "query": "zookeeper_version{__$labels__}"
    },
    {
      "metric_group": "System Status",
      "name": "num_alive_connections",
      "display_name": "Alive Connections",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of active client connections, a key metric for measuring real-time service load and concurrency pressure.",
      "query": "zookeeper_num_alive_connections{__$labels__}"
    },
    {
      "metric_group": "System Status",
      "name": "outstanding_requests",
      "display_name": "Outstanding Requests",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of requests queued for processing. Consistently high values indicate potential service processing bottlenecks.",
      "query": "zookeeper_outstanding_requests{__$labels__}"
    },
    {
      "metric_group": "Performance Metrics",
      "name": "avg_latency",
      "display_name": "Average Latency",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Average response time for client requests, the primary metric for evaluating Zookeeper core performance.",
      "query": "zookeeper_avg_latency{__$labels__}"
    },
    {
      "metric_group": "Performance Metrics",
      "name": "max_latency",
      "display_name": "Maximum Latency",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Maximum recorded response time for a single request, reflecting performance bottlenecks under extreme conditions.",
      "query": "zookeeper_max_latency{__$labels__}"
    },
    {
      "metric_group": "Performance Metrics",
      "name": "min_latency",
      "display_name": "Minimum Latency",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Minimum response time for processing requests, representing the best performance under ideal conditions.",
      "query": "zookeeper_min_latency{__$labels__}"
    },
    {
      "metric_group": "Performance Metrics",
      "name": "packets_received",
      "display_name": "Packets Received",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Total number of network packets received by the server, measuring network input traffic.",
      "query": "zookeeper_packets_received{__$labels__}"
    },
    {
      "metric_group": "Performance Metrics",
      "name": "packets_sent",
      "display_name": "Packets Sent",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Total number of network packets sent by the server, measuring network output traffic.",
      "query": "zookeeper_packets_sent{__$labels__}"
    },
    {
      "metric_group": "Data Storage",
      "name": "watch_count",
      "display_name": "Watch Count",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of watchers currently registered on ZNodes, reflecting client interest in data changes.",
      "query": "zookeeper_watch_count{__$labels__}"
    },
    {
      "metric_group": "Data Storage",
      "name": "ephemerals_count",
      "display_name": "Ephemeral Nodes",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of ephemeral nodes in the current data tree, typically associated with session lifecycle.",
      "query": "zookeeper_ephemerals_count{__$labels__}"
    },
    {
      "metric_group": "Data Storage",
      "name": "znode_count",
      "display_name": "ZNode Count",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Total number of all nodes in the Zookeeper data tree, reflecting the scale and complexity of the data structure.",
      "query": "zookeeper_znode_count{__$labels__}"
    },
    {
      "metric_group": "Data Storage",
      "name": "approximate_data_size",
      "display_name": "Data Size",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "bytes",
      "dimensions": [],
      "description": "Approximate memory footprint of all stored ZNode data, used for capacity planning.",
      "query": "zookeeper_approximate_data_size{__$labels__}"
    },
    {
      "metric_group": "Resource Usage",
      "name": "open_file_descriptor_count",
      "display_name": "Open File Descriptors",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of file descriptors currently open by the process. Nearing the system limit may impact service.",
      "query": "zookeeper_open_file_descriptor_count{__$labels__}"
    },
    {
      "metric_group": "Resource Usage",
      "name": "max_file_descriptor_count",
      "display_name": "Max File Descriptors",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Maximum number of file descriptors the operating system allows for this process, a configurable resource limit.",
      "query": "zookeeper_max_file_descriptor_count{__$labels__}"
    },
    {
      "metric_group": "Resource Usage",
      "name": "fsync_threshold_exceed_count",
      "display_name": "Fsync Threshold Exceed",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "counts",
      "dimensions": [],
      "description": "Number of times transaction log sync to disk exceeded the time threshold, indicating disk I/O performance issues.",
      "query": "zookeeper_fsync_threshold_exceed_count{__$labels__}"
    },
    {
      "metric_group": "Performance Trends",
      "name": "packets_received_rate",
      "display_name": "Packets Received Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "cps",
      "dimensions": [],
      "description": "Average packet reception rate over the past 5 minutes, reflecting real-time network input load.",
      "query": "rate(zookeeper_packets_received{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance Trends",
      "name": "packets_sent_rate",
      "display_name": "Packets Sent Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "cps",
      "dimensions": [],
      "description": "Average packet transmission rate over the past 5 minutes, reflecting real-time network output load.",
      "query": "rate(zookeeper_packets_sent{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance Trends",
      "name": "fsync_threshold_exceed_rate",
      "display_name": "Fsync Exceed Rate",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "cps",
      "dimensions": [],
      "description": "Frequency of Fsync operation threshold exceedances over the past 5 minutes, monitoring trends in disk performance degradation.",
      "query": "rate(zookeeper_fsync_threshold_exceed_count{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance Trends",
      "name": "avg_latency_avg",
      "display_name": "Avg Latency Trend",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Moving average of latency over the past 5 minutes, smoothing out instant fluctuations to observe stable trends.",
      "query": "avg_over_time(zookeeper_avg_latency{__$labels__}[5m])"
    },
    {
      "metric_group": "Performance Trends",
      "name": "max_latency_max",
      "display_name": "Max Latency Peak",
      "instance_id_keys": ["instance_id"],
      "data_type": "Number",
      "unit": "ms",
      "dimensions": [],
      "description": "Maximum latency value recorded in the past 5 minutes, identifying the most severe performance event within the timeframe.",
      "query": "max_over_time(zookeeper_max_latency{__$labels__}[5m])"
    }
  ]
}