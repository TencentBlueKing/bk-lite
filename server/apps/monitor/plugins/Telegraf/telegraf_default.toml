[global_tags]
    agent_id="${node.ip}-${node.cloud_region}"

[agent]
    interval = "10s"
    round_interval = true
    metric_batch_size = 1000
    metric_buffer_limit = 10000
    collection_jitter = "0s"
    flush_interval = "30s"
    flush_jitter = "0s"
    precision = "0s"
    hostname = "${node.ip}"
    omit_hostname = false

[[inputs.internal]]
    tags = { "instance_id"="${node.ip}-${node.cloud_region}","instance_type"="internal","instance_name"="${node.name}" }

[[outputs.nats]]
    servers = ["${NATS_PROTOCOL}://${NATS_SERVERS}"]
    username = "${NATS_USERNAME}"
    password = "${NATS_PASSWORD}"
    subject = "metrics.${node.ip_filter}"
    data_format = "influx"

{% if NATS_PROTOCOL == "tls" %}
    # TLS 配置
    tls_enable = true
    insecure_skip_verify = false
    tls_ca = "${NATS_TLS_CA_FILE}"
{% endif %}
