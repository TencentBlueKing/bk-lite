# ====================================
# 默认Logstash协议接收服务
# ====================================
[sources.default_logs]
type = "logstash"
address = "0.0.0.0:15044"
mode = "tcp"
# ====================================
# 基础字段补全（最小化处理）
# ====================================
[transforms.default_enrich]
type = "remap"
inputs = ["default_logs"]
source = '''
# 添加Vector接收的基础元数据
.collect_method = "filebeat"
.node_ip = "${node.ip}"
.received_at = now()
# 确保基础字段存在
if !exists(.timestamp) {
  .timestamp = now()
}
'''
# ====================================
# 直接输出到NATS（零业务逻辑）
# ====================================
[sinks.default_vmlogs]
type = "nats"
inputs = ["default_enrich"]
subject = "vector"
url = "nats://${NATS_SERVERS}"
[sinks.default_vmlogs.auth]
strategy = "user_password"
[sinks.default_vmlogs.auth.user_password]
user = "${NATS_USERNAME}"
password = "${NATS_PASSWORD}"
[sinks.default_vmlogs.encoding]
codec = "json"
