[
  {
    "id": "Winlogbeat_windows",
    "name": "Winlogbeat",
    "controller_default_run": false,
    "icon": "",
    "node_operating_system": "windows",
    "service_type": "exec",
    "executable_path": "C:\\Program Files\\fusion-collectors\\bin\\winlogbeat.exe",
    "execute_parameters": "-c %s",
    "validation_parameters": "",
    "default_template": "",
    "introduction": "Winlogbeat is a lightweight shipper for Windows event logs collection and security monitoring using official Logstash protocol.",
    "enabled_default_config": true,
    "default_config": {
      "nats": "# ================================== General ===================================\nname: \"winlogbeat-${node.ip}-${node.cloud_region}\"\ntags: [\"bk-lite\", \"logstash\", \"windows\"]\n# ================================== Logging ===================================\nlogging.level: info\nlogging.to_files: true\nlogging.files:\n  path: C:\\ProgramData\\fusion-collectors\\log\\winlogbeat\n  name: winlogbeat\n  keepfiles: 7\n  permissions: 0600\n# ================================== Outputs ===================================\noutput.logstash:\n  hosts: [\"localhost:15044\"]\n  worker: 1\n  bulk_max_size: 2048\n  timeout: 30s\n  max_retries: 3\n# ================================== Processors ===================================\nprocessors:\n  - add_host_metadata:\n      when.not.contains.tags: forwarded\n\n  - script:\n      lang: javascript\n      source: >\n        function process(event) {\n          var evt = event.Get();\n          \n          // 标准化时间戳\n          if (evt['@timestamp']) {\n            event.Put('timestamp', evt['@timestamp']);\n          }\n          \n          // Windows 事件基础信息\n          if (evt.winlog) {\n            event.Put('event_id', evt.winlog.event_id || 0);\n            event.Put('event_provider', evt.winlog.provider_name || 'unknown');\n            event.Put('event_channel', evt.winlog.channel || 'unknown');\n            event.Put('computer_name', evt.winlog.computer_name || evt.host.name || 'unknown');\n            \n            // 基础用户信息提取\n            if (evt.winlog.event_data) {\n              var eventData = evt.winlog.event_data;\n              if (eventData.TargetUserName) {\n                event.Put('target_user_name', eventData.TargetUserName);\n              }\n            }\n          }\n          \n          return event;\n        }\n\n\n# ================================== Event Logs ===================================\nwinlogbeat.event_logs:\n# ================================== 健康检查模式 - 最小数据量 ==================================\n- name: Security\n  level: warning  # 只采集warning及以上级别，减少数据量\n  event_id: 4625  # 仅监控登录失败事件，用于验证功能\n  ignore_older: 30m  # 缩短到30分钟，与其他Beat保持一致\n\n  fields:\n    log_type: \"winlogbeat\"\n    component: \"security\"\n    health_check_mode: true\n    node_ip: \"${node.ip}\"\n    cloud_region: \"${node.cloud_region}\"\n  fields_under_root: false\n"
    }
  }
]

