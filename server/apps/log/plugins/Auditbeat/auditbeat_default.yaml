# ================================== General ===================================
name: "auditbeat-${node.ip}-${node.cloud_region}"
tags: ["bk-lite", "logstash", "security"]
# ================================== Logging ===================================
logging.level: info
logging.to_files: true
logging.files:
  path: /opt/fusion-collectors/log/auditbeat
  name: auditbeat
  keepfiles: 7
  permissions: 0600
# ================================== Outputs ===================================
output.logstash:
  hosts: ["localhost:15044"]
  worker: 1
  bulk_max_size: 2048
  timeout: 30s
  max_retries: 3
# ================================== Processors ===================================
processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
# ================================== Modules ===================================
auditbeat.modules:
- module: file_integrity
  enabled: true

  # 只监控一个最轻量的文件，避免重复
  paths:
  - /etc/hostname

  # 大幅减少扫描频率，降低资源占用
  scan_frequency: 600s  # 改为10分钟，减少一半扫描频率
  hash_types: [md5]     # 从sha1改为md5，计算更快
  max_file_size: 100KB  # 从1MB降低到100KB，减少处理开销

  fields:
    log_type: "auditbeat"
    health_check_mode: true
    _msg: "health check"
  fields_under_root: true
