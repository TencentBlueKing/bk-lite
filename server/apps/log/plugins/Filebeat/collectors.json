[
  {
    "id": "Filebeat_linux",
    "name": "Filebeat",
    "controller_default_run": false,
    "icon": "",
    "node_operating_system": "linux",
    "service_type": "exec",
    "executable_path": "/opt/fusion-collectors/bin/filebeat",
    "execute_parameters": "-c %s",
    "validation_parameters": "",
    "default_template": "",
    "introduction": "Filebeat is a lightweight shipper for forwarding and centralizing log data using official Logstash protocol.",
    "enabled_default_config": true,
    "default_config": {
      "nats": "# ================================== General ===================================\nname: \"filebeat-${node.ip}-${node.cloud_region}\"\ntags: [\"bk-lite\", \"logstash\"]\n\n# ================================== Logging ===================================\nlogging.level: info\nlogging.to_files: true\nlogging.files:\n  path: /opt/fusion-collectors/log/filebeat\n  name: filebeat\n  keepfiles: 7\n  permissions: 0600\n\n# ================================== Outputs ===================================\noutput.logstash:\n  hosts: [\"localhost:15044\"]\n  worker: 1\n  bulk_max_size: 2048\n  timeout: 30s\n  max_retries: 3\n\n# ================================== Inputs ===================================\nfilebeat.inputs:\n# ================================== 健康检查模式 - 最小数据量 ==================================\n- type: filestream\n  id: filebeat-health-check\n  enabled: true\n  paths:\n    - /opt/fusion-collectors/log/filebeat/filebeat-*.ndjson\n\n  # 减少数据量配置\n  scan_frequency: 300s  # 进一步降低到5分钟\n  close_inactive: 60s   # 1分钟后关闭非活跃文件\n  ignore_older: 30m     # 只处理30分钟内的文件\n\n  # 移除ERROR过滤 - Filebeat正常运行时很少产生ERROR\n  # 改为监控启动和关闭事件来验证功能\n  include_lines: ['\"message\":\"Starting filebeat\"', '\"message\":\"Stopping filebeat\"', '\"message\":\"filebeat stopped\"']\n\n  fields:\n    log_type: \"filebeat\"\n    component: \"self\"\n    health_check_mode: true\n    node_ip: \"${node.ip}\"\n    cloud_region: \"${node.cloud_region}\"\n  fields_under_root: false\n\n  # 移除复杂的JSON解析器\n  processors:\n    - drop_fields:\n        fields: [\"agent.ephemeral_id\", \"ecs.version\"]\n        ignore_missing: true\n"
    }
  }
]
