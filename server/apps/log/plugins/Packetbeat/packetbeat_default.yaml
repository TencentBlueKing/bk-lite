# ================================== General ===================================
name: "packetbeat-${node.ip}-${node.cloud_region}"
tags: ["bk-lite", "logstash", "network"]
# ================================== Logging ===================================
logging.level: info
logging.to_files: true
logging.files:
  path: /opt/fusion-collectors/log/packetbeat
  name: packetbeat
  keepfiles: 7
  permissions: 0600
# ================================== Outputs ===================================
output.logstash:
  hosts: ["localhost:15044"]
  worker: 1
  bulk_max_size: 2048
  timeout: 30s
  max_retries: 3
# ================================== Interfaces ===================================
packetbeat.interfaces.device: any
packetbeat.interfaces.snaplen: 1514
packetbeat.interfaces.type: af_packet
packetbeat.interfaces.buffer_size_mb: 30
# ================================== Processors ===================================
processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
# ================================== Protocols ===================================
packetbeat.protocols:
- type: icmp
  enabled: true

  # 添加采样配置，减少数据量
  sample_rate: 0.1  # 只采样10%的ICMP包，大幅减少数据量

  fields:
    log_type: "packetbeat"
    health_check_mode: true
    _msg: "health check"
  fields_under_root: true
