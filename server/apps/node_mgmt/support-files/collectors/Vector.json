[
  {
    "id": "Vector_linux",
    "name": "Vector",
    "controller_default_run": false,
    "icon": "",
    "node_operating_system": "linux",
    "service_type": "exec",
    "executable_path": "/opt/fusion-collectors/bin/vector",
    "execute_parameters": "--config %s",
    "validation_parameters": "",
    "default_template": "",
    "introduction": "Vector is a high-performance observability data pipeline that collects, processes, and routes logs, metrics, and traces from various sources to multiple destinations, providing real-time insights into system performance and health.",
    "enabled_default_config": true,
    "default_config": {
      "nats": "# ====================================\n# 默认Logstash协议接收服务\n# ====================================\n[sources.default_logs]\ntype = \"logstash\"\naddress = \"0.0.0.0:15044\"\nmode = \"tcp\"\n# ====================================\n# 基础字段补全（最小化处理）\n# ====================================\n[transforms.default_enrich]\ntype = \"remap\"\ninputs = [\"default_logs\"]\nsource = '''\n# 添加Vector接收的基础元数据\n.collect_method = \"filebeat\"\n.node_ip = \"${node.ip}\"\n.received_at = now()\n# 确保基础字段存在\nif !exists(.timestamp) {\n  .timestamp = now()\n}\n'''\n# ====================================\n# 直接输出到NATS（零业务逻辑）\n# ====================================\n[sinks.default_vmlogs]\ntype = \"nats\"\ninputs = [\"default_enrich\"]\nsubject = \"vector\"\nurl = \"${NATS_PROTOCOL}://${NATS_SERVERS}\"\n\n[sinks.default_vmlogs.auth]\nstrategy = \"user_password\"\n\n[sinks.default_vmlogs.auth.user_password]\nuser = \"${NATS_USERNAME}\"\npassword = \"${NATS_PASSWORD}\"\n\n{% if NATS_PROTOCOL == \"tls\" %}\n# TLS 配置\n[sinks.default_vmlogs.tls]\nenabled = true\nskip_cert_verify = false\nca_file = \"${NATS_TLS_CA_FILE}\"\n{% endif %}\n\n[sinks.default_vmlogs.encoding]\ncodec = \"json\"\n",
      "add_config": "# ====================================\n# Vector SNMP Trap 接收配置\n# 通过 Unix Socket 接收 snmptrapd 的 trap（同主机最优方案）\n# ====================================\n\n# ====================================\n# Source: Unix Socket 接收 trap\n# ====================================\n[sources.snmp_trap]\ntype = \"socket\"\nmode = \"unix_datagram\"\npath = \"/var/run/vector/snmp_trap.sock\"\nmax_length = 102400\n\n# ====================================\n# Transform: 解析 trap 数据\n# ====================================\n[transforms.snmp_trap_parse]\ntype = \"remap\"\ninputs = [\"snmp_trap\"]\nsource = '''\n# 基础标记\n.collector = \"Snmptrapd\"\n.collect_type = \"snmp_trap\"\n.event_type = \"snmp_trap\"\n\n# 解析 trap 消息\n# snmptrapd 输出格式示例：\n# \"hostname [UDP: [192.168.1.1]:161->[192.168.1.254]:162]:\\niso.3.6.1.6.3.1.1.4.1.0 = OID: iso.3.6.1.6.3.1.1.5.3\"\n\nmsg = string!(.message)\n\n# 提取 UDP 源地址\nudp_match = parse_regex(msg, r\"UDP:\\s*\\[(?P<src_ip>[^\\]]+)\\]\")\nif udp_match != null {\n  .source_ip = string!(udp_match.src_ip)\n  .source = .source_ip\n}\n\n# 提取 trap OID\n# 查找 snmpTrapOID 的值\noid_match = parse_regex(msg, r\"(?:iso|1)\\.3\\.6\\.1\\.6\\.3\\.1\\.1\\.4\\.1\\.0\\s*=\\s*OID:\\s*(?:iso\\.)?(?P<oid>[\\d\\.]+)\")\nif oid_match != null {\n  .trap_oid = \"1.\" + string!(oid_match.oid)\n\n  # 识别常见 trap 类型\n  oid = .trap_oid\n  if starts_with(oid, \"1.3.6.1.6.3.1.1.5.3\") {\n    .trap_type = \"linkDown\"\n    .severity = \"warning\"\n  } else if starts_with(oid, \"1.3.6.1.6.3.1.1.5.4\") {\n    .trap_type = \"linkUp\"\n    .severity = \"info\"\n  } else if starts_with(oid, \"1.3.6.1.6.3.1.1.5.1\") {\n    .trap_type = \"coldStart\"\n    .severity = \"critical\"\n  } else if starts_with(oid, \"1.3.6.1.6.3.1.1.5.2\") {\n    .trap_type = \"warmStart\"\n    .severity = \"warning\"\n  } else if starts_with(oid, \"1.3.6.1.6.3.1.1.5.5\") {\n    .trap_type = \"authenticationFailure\"\n    .severity = \"error\"\n  } else {\n    .trap_type = \"custom\"\n    .severity = \"info\"\n  }\n} else {\n  .trap_type = \"unknown\"\n  .trap_oid = \"unknown\"\n  .severity = \"info\"\n}\n\n# 时间戳\n.timestamp = now()\n\n# 保留原始消息\n.raw_message = msg\n'''\n\n# ====================================\n# Sink: 发送到 NATS\n# ====================================\n[sinks.snmp_trap_nats]\ntype = \"nats\"\ninputs = [\"snmp_trap_parse\"]\nsubject = \"snmp.trap\"\nurl = \"${NATS_PROTOCOL}://${NATS_SERVERS}\"\n\n[sinks.snmp_trap_nats.auth]\nstrategy = \"user_password\"\n\n[sinks.snmp_trap_nats.auth.user_password]\nuser = \"${NATS_USERNAME}\"\npassword = \"${NATS_PASSWORD}\"\n\n[sinks.snmp_trap_nats.encoding]\ncodec = \"json\"\n\n# ====================================\n# Sink: 本地日志备份（可选）\n# ====================================\n[sinks.snmp_trap_log]\ntype = \"file\"\ninputs = [\"snmp_trap_parse\"]\npath = \"/var/log/snmp_traps/trap_%Y%m%d.log\"\nidle_timeout_secs = 30\n\n[sinks.snmp_trap_log.encoding]\ncodec = \"json\"\n"
    },
    "tags": ["linux", "log"],
    "package_name": "vector"
  }
]
