# K8S å·¥å…·æ‰©å±•èƒ½åŠ›è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€ç°æœ‰èƒ½åŠ›å®¡æŸ¥ (Review)

### 1.1 å·²å®ç°çš„å·¥å…·åˆ†ç±»

æ ¹æ®ä»£ç å®¡æŸ¥ï¼Œç°æœ‰å·¥å…·åˆ†ä¸ºä»¥ä¸‹æ¨¡å—ï¼š

#### **åŸºç¡€èµ„æºæŸ¥è¯¢ (resources.py)** âœ…
- `get_kubernetes_namespaces` - å‘½åç©ºé—´åˆ—è¡¨
- `list_kubernetes_pods` - Podåˆ—è¡¨
- `list_kubernetes_nodes` - èŠ‚ç‚¹åˆ—è¡¨
- `list_kubernetes_deployments` - Deploymentåˆ—è¡¨
- `list_kubernetes_services` - Serviceåˆ—è¡¨
- `list_kubernetes_events` - äº‹ä»¶åˆ—è¡¨
- `get_kubernetes_resource_yaml` - è·å–èµ„æºYAML
- `get_kubernetes_pod_logs` - Podæ—¥å¿—ï¼ˆæ”¯æŒtail/headï¼‰

#### **æ•…éšœè¯Šæ–­ (diagnostics.py)** âœ…
- `get_failed_kubernetes_pods` - å¤±è´¥Podåˆ—è¡¨
- `get_pending_kubernetes_pods` - Pending Podåˆ—è¡¨
- `get_high_restart_kubernetes_pods` - é«˜é‡å¯Pod
- `get_kubernetes_node_capacity` - èŠ‚ç‚¹å®¹é‡åˆ†æ
- `get_kubernetes_orphaned_resources` - å­¤ç«‹èµ„æºæ£€æŸ¥
- `diagnose_kubernetes_pod_issues` - Podç»¼åˆè¯Šæ–­

#### **é…ç½®åˆ†æ (analysis.py)** âœ…
- `check_kubernetes_resource_quotas` - èµ„æºé…é¢æ£€æŸ¥
- `check_kubernetes_network_policies` - ç½‘ç»œç­–ç•¥æ£€æŸ¥
- `check_kubernetes_persistent_volumes` - PV/PVCæ£€æŸ¥
- `check_kubernetes_ingress` - Ingressé…ç½®æ£€æŸ¥
- `check_kubernetes_daemonsets/statefulsets/jobs` - å·¥ä½œè´Ÿè½½æ£€æŸ¥
- `check_kubernetes_endpoints` - Endpointsæ£€æŸ¥
- `analyze_deployment_configurations` - Deploymenté…ç½®åˆ†æ
- `check_kubernetes_hpa_status` - HPAçŠ¶æ€æ£€æŸ¥

#### **é›†ç¾¤ç®¡ç† (cluster.py)** âœ…
- `verify_kubernetes_connection` - è¿æ¥éªŒè¯
- `get_kubernetes_contexts` - ä¸Šä¸‹æ–‡ç®¡ç†
- `list_kubernetes_api_resources` - APIèµ„æºåˆ—è¡¨
- `explain_kubernetes_resource` - èµ„æºç±»å‹è¯´æ˜
- `describe_kubernetes_resource` - èµ„æºè¯¦æƒ…æè¿°
- `kubernetes_troubleshooting_guide` - æ•…éšœæ’æŸ¥æŒ‡å¯¼

#### **é«˜çº§æŸ¥è¯¢ (query.py)** âœ…
- `kubectl_get_resources` - çµæ´»èµ„æºæŸ¥è¯¢ï¼ˆæ”¯æŒæ ‡ç­¾/å­—æ®µé€‰æ‹©å™¨ï¼‰
- `kubectl_get_all_resources` - æ‰¹é‡èµ„æºæŸ¥è¯¢

### 1.2 ç°æœ‰èƒ½åŠ›çš„ä¼˜åŠ¿
- âœ… è¦†ç›–äº†åŸºç¡€çš„CRUDæ“ä½œ
- âœ… æä¾›äº†åŸºæœ¬çš„æ•…éšœè¯Šæ–­èƒ½åŠ›
- âœ… æ”¯æŒå¤šç§èµ„æºç±»å‹
- âœ… å…·å¤‡ä¸€å®šçš„é…ç½®åˆ†æèƒ½åŠ›

### 1.3 ç°æœ‰èƒ½åŠ›çš„ä¸è¶³ (Gap Analysis)

#### ğŸš¨ **æ•…éšœè¯Šæ–­ç»´åº¦**
- âŒ **ç¼ºä¹æ—¶åºæ€§åˆ†æ**: æ— æ³•åˆ†æèµ„æºçŠ¶æ€çš„å†å²å˜åŒ–è¶‹åŠ¿
- âŒ **ç¼ºä¹å…³è”æ€§åˆ†æ**: ä¸èƒ½è·¨èµ„æºå…³è”è¯Šæ–­ï¼ˆPodâ†’Serviceâ†’Ingressé“¾è·¯ï¼‰
- âŒ **ç¼ºä¹æ ¹å› åˆ†æ**: åªèƒ½æŸ¥çœ‹ç°è±¡ï¼Œæ— æ³•æ¨æ–­æ ¹æœ¬åŸå› 
- âŒ **ç¼ºä¹æ€§èƒ½è¯Šæ–­**: æ²¡æœ‰CPU/å†…å­˜å‹åŠ›ã€ç½‘ç»œå»¶è¿Ÿã€I/Oç­‰æ€§èƒ½æŒ‡æ ‡
- âŒ **ç¼ºä¹å®‰å…¨æ£€æŸ¥**: æ²¡æœ‰æƒé™ã€å®‰å…¨ç­–ç•¥ã€é•œåƒæ¼æ´ç­‰å®‰å…¨è¯Šæ–­

#### ğŸ”§ **æ•…éšœè‡ªæ„ˆç»´åº¦**
- âŒ **å®Œå…¨ç¼ºå¤±æ“ä½œèƒ½åŠ›**: æ— æ³•æ‰§è¡Œä»»ä½•ä¿®å¤æ“ä½œï¼ˆé‡å¯ã€æ‰©å®¹ã€æ›´æ–°é…ç½®ï¼‰
- âŒ **æ— å›æ»šæœºåˆ¶**: ä¸æ”¯æŒDeployment/StatefulSetçš„ç‰ˆæœ¬å›æ»š
- âŒ **æ— è‡ªåŠ¨ä¿®å¤**: æ— æ³•æ‰§è¡Œå¸¸è§é—®é¢˜çš„è‡ªåŠ¨åŒ–ä¿®å¤æµç¨‹

#### ğŸ’¡ **é…ç½®ä¼˜åŒ–ç»´åº¦**
- âŒ **ç¼ºä¹æˆæœ¬ä¼˜åŒ–**: æ²¡æœ‰èµ„æºæµªè´¹åˆ†æï¼ˆover-provisionedã€idleèµ„æºï¼‰
- âŒ **ç¼ºä¹å®‰å…¨åŠ å›º**: æ²¡æœ‰å®‰å…¨æœ€ä½³å®è·µæ£€æŸ¥å’Œå»ºè®®
- âŒ **ç¼ºä¹æ€§èƒ½ä¼˜åŒ–**: ç¼ºå°‘æ€§èƒ½è°ƒä¼˜å»ºè®®ï¼ˆäº²å’Œæ€§ã€æ‹“æ‰‘åˆ†å¸ƒï¼‰
- âŒ **ç¼ºä¹å¯é æ€§å»ºè®®**: æ²¡æœ‰é«˜å¯ç”¨æ€§ã€å®¹ç¾ç­‰æ¶æ„å»ºè®®

---

## äºŒã€åœºæ™¯é©±åŠ¨çš„èƒ½åŠ›å»ºè®¾ (Scenario-Driven Design)

### 2.1 æ•…éšœè¯Šæ–­åœºæ™¯

#### **åœºæ™¯ 1: åº”ç”¨æ— æ³•è®¿é—®**
**ç”¨æˆ·è¾“å…¥**: "æˆ‘çš„åº”ç”¨æ— æ³•è®¿é—®äº†ï¼Œå¸®æˆ‘æ’æŸ¥ä¸€ä¸‹"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. è¯†åˆ«åº”ç”¨ï¼ˆé€šè¿‡åç§°/æ ‡ç­¾æ‰¾åˆ°ç›¸å…³Podã€Serviceã€Ingressï¼‰
2. æ£€æŸ¥è®¿é—®é“¾è·¯å¥åº·ï¼ˆIngressâ†’Serviceâ†’Endpointsâ†’Podï¼‰
3. åˆ†æç½‘ç»œç­–ç•¥æ˜¯å¦é˜»æ–­
4. æ£€æŸ¥Podå¥åº·çŠ¶æ€å’Œå°±ç»ªæ¢é’ˆ
5. åˆ†ææœ€è¿‘çš„äº‹ä»¶å’Œæ—¥å¿—
6. å…³è”åˆ†æï¼šèŠ‚ç‚¹æ•…éšœã€å­˜å‚¨é—®é¢˜ç­‰

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `trace_service_chain` - è¿½è¸ªæœåŠ¡å®Œæ•´è°ƒç”¨é“¾
- âœ¨ `analyze_network_path` - ç½‘ç»œè·¯å¾„åˆ†æ
- âœ¨ `get_resource_events_timeline` - èµ„æºäº‹ä»¶æ—¶é—´çº¿
- âœ¨ `correlate_pod_issues` - è·¨èµ„æºå…³è”åˆ†æ

#### **åœºæ™¯ 2: Podé¢‘ç¹é‡å¯**
**ç”¨æˆ·è¾“å…¥**: "æˆ‘çš„Podä¸€ç›´åœ¨é‡å¯ï¼Œå¸®æˆ‘æ‰¾å‡ºåŸå› "

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. è¯†åˆ«é«˜é‡å¯Podï¼ˆå·²æœ‰ï¼‰
2. åˆ†æé‡å¯å†å²è¶‹åŠ¿
3. æ£€æŸ¥OOMã€é€€å‡ºç ã€å´©æºƒæ—¥å¿—
4. åˆ†æèµ„æºé™åˆ¶æ˜¯å¦åˆç†
5. æ£€æŸ¥å­˜å‚¨/é…ç½®/Secretæ˜¯å¦å¼‚å¸¸
6. æ¨èä¿®å¤æ–¹æ¡ˆ

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `analyze_pod_restart_pattern` - Podé‡å¯æ¨¡å¼åˆ†æ
- âœ¨ `check_oom_events` - OOMäº‹ä»¶æ£€æµ‹
- âœ¨ `recommend_resource_limits` - èµ„æºé…é¢å»ºè®®
- âœ¨ `get_pod_crash_report` - Podå´©æºƒæŠ¥å‘Š

#### **åœºæ™¯ 3: é›†ç¾¤æ€§èƒ½ä¸‹é™**
**ç”¨æˆ·è¾“å…¥**: "é›†ç¾¤æœ€è¿‘å¾ˆæ…¢ï¼Œå¸®æˆ‘åˆ†ææ€§èƒ½ç“¶é¢ˆ"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. åˆ†æé›†ç¾¤æ•´ä½“èµ„æºä½¿ç”¨è¶‹åŠ¿
2. è¯†åˆ«èµ„æºçƒ­ç‚¹ï¼ˆCPU/å†…å­˜/ç½‘ç»œé«˜çš„èŠ‚ç‚¹å’ŒPodï¼‰
3. æ£€æŸ¥è°ƒåº¦å‹åŠ›å’Œé©±é€äº‹ä»¶
4. åˆ†æI/Oç“¶é¢ˆå’Œå­˜å‚¨æ€§èƒ½
5. æ£€æŸ¥HPAæ˜¯å¦æ­£å¸¸å·¥ä½œ
6. æä¾›ä¼˜åŒ–å»ºè®®

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `analyze_cluster_performance` - é›†ç¾¤æ€§èƒ½åˆ†æ
- âœ¨ `identify_resource_hotspots` - èµ„æºçƒ­ç‚¹è¯†åˆ«
- âœ¨ `check_pod_eviction_pressure` - é©±é€å‹åŠ›æ£€æŸ¥
- âœ¨ `analyze_scheduling_latency` - è°ƒåº¦å»¶è¿Ÿåˆ†æ

### 2.2 æ•…éšœè‡ªæ„ˆåœºæ™¯

#### **åœºæ™¯ 4: è‡ªåŠ¨é‡å¯å¤±è´¥çš„Pod**
**ç”¨æˆ·è¾“å…¥**: "è¿™ä¸ªPodå¤±è´¥äº†ï¼Œå¸®æˆ‘é‡å¯ä¸€ä¸‹"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. ç¡®è®¤PodçŠ¶æ€å’Œå¤±è´¥åŸå› 
2. åˆ›å»ºå¤‡ä»½/å¿«ç…§ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
3. æ‰§è¡Œåˆ é™¤æ“ä½œè§¦å‘é‡å»º
4. ç›‘æ§æ–°Podå¯åŠ¨çŠ¶æ€
5. éªŒè¯æ¢å¤æˆåŠŸ

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `restart_pod` - å®‰å…¨é‡å¯Podï¼ˆwith validationï¼‰
- âœ¨ `delete_kubernetes_resource` - åˆ é™¤èµ„æºï¼ˆæ”¯æŒä¼˜é›…åˆ é™¤ï¼‰
- âœ¨ `wait_for_pod_ready` - ç­‰å¾…Podå°±ç»ª

#### **åœºæ™¯ 5: å¿«é€Ÿæ‰©å®¹åº”å¯¹æµé‡æ¿€å¢**
**ç”¨æˆ·è¾“å…¥**: "æµé‡çªç„¶å¢å¤§ï¼Œå¸®æˆ‘æ‰©å®¹åˆ°10ä¸ªå‰¯æœ¬"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. æ£€æŸ¥å½“å‰Deploymentå‰¯æœ¬æ•°
2. éªŒè¯é›†ç¾¤æ˜¯å¦æœ‰è¶³å¤Ÿèµ„æº
3. æ‰§è¡Œæ‰©å®¹æ“ä½œ
4. ç›‘æ§æ–°Podå¯åŠ¨è¿›åº¦
5. éªŒè¯æ‰©å®¹åçš„å¥åº·çŠ¶æ€

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `scale_deployment` - æ‰©ç¼©å®¹Deployment/StatefulSet
- âœ¨ `check_scaling_capacity` - æ£€æŸ¥æ‰©å®¹å¯è¡Œæ€§
- âœ¨ `monitor_scaling_progress` - ç›‘æ§æ‰©ç¼©å®¹è¿›åº¦

#### **åœºæ™¯ 6: å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬**
**ç”¨æˆ·è¾“å…¥**: "æ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. æŸ¥çœ‹Deploymentå‘å¸ƒå†å²
2. è¯†åˆ«ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
3. æ‰§è¡Œå›æ»šæ“ä½œ
4. ç›‘æ§å›æ»šè¿›åº¦å’Œå¥åº·çŠ¶æ€
5. éªŒè¯å›æ»šæˆåŠŸ

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `get_deployment_revision_history` - è·å–å‘å¸ƒå†å²
- âœ¨ `rollback_deployment` - å›æ»šDeployment
- âœ¨ `compare_deployment_revisions` - å¯¹æ¯”å‘å¸ƒç‰ˆæœ¬å·®å¼‚

### 2.3 é…ç½®ä¼˜åŒ–åœºæ™¯

#### **åœºæ™¯ 7: æˆæœ¬ä¼˜åŒ–åˆ†æ**
**ç”¨æˆ·è¾“å…¥**: "å¸®æˆ‘åˆ†æä¸€ä¸‹é›†ç¾¤çš„èµ„æºæµªè´¹æƒ…å†µï¼Œå¦‚ä½•é™ä½æˆæœ¬"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. åˆ†æèµ„æºè¯·æ±‚vså®é™…ä½¿ç”¨
2. è¯†åˆ«è¿‡åº¦åˆ†é…çš„Pod
3. å‘ç°é—²ç½®èµ„æºï¼ˆç©ºèŠ‚ç‚¹ã€æœªä½¿ç”¨çš„PVï¼‰
4. è®¡ç®—æ½œåœ¨èŠ‚çœæˆæœ¬
5. æä¾›ä¼˜åŒ–å»ºè®®

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `analyze_resource_waste` - èµ„æºæµªè´¹åˆ†æ
- âœ¨ `recommend_resource_right_sizing` - èµ„æºå®¹é‡ä¼˜åŒ–å»ºè®®
- âœ¨ `identify_idle_resources` - é—²ç½®èµ„æºè¯†åˆ«
- âœ¨ `calculate_cost_savings` - æˆæœ¬èŠ‚çœä¼°ç®—

#### **åœºæ™¯ 8: å®‰å…¨åŠ å›ºæ£€æŸ¥**
**ç”¨æˆ·è¾“å…¥**: "å¸®æˆ‘æ£€æŸ¥é›†ç¾¤çš„å®‰å…¨é…ç½®ï¼Œç»™å‡ºåŠ å›ºå»ºè®®"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. æ£€æŸ¥Podå®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆrunAsNonRootç­‰ï¼‰
2. åˆ†æRBACæƒé™é…ç½®
3. æ£€æŸ¥é•œåƒå®‰å…¨ï¼ˆlatestæ ‡ç­¾ã€ç§æœ‰é•œåƒï¼‰
4. éªŒè¯ç½‘ç»œç­–ç•¥è¦†ç›–
5. æ£€æŸ¥SecretåŠ å¯†å’Œä½¿ç”¨
6. ç”Ÿæˆå®‰å…¨æŠ¥å‘Š

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `audit_security_policies` - å®‰å…¨ç­–ç•¥å®¡è®¡
- âœ¨ `check_pod_security_standards` - Podå®‰å…¨æ ‡å‡†æ£€æŸ¥
- âœ¨ `analyze_rbac_permissions` - RBACæƒé™åˆ†æ
- âœ¨ `scan_image_vulnerabilities` - é•œåƒæ¼æ´æ‰«æï¼ˆé›†æˆï¼‰
- âœ¨ `generate_security_report` - ç”Ÿæˆå®‰å…¨æŠ¥å‘Š

#### **åœºæ™¯ 9: é«˜å¯ç”¨æ¶æ„å»ºè®®**
**ç”¨æˆ·è¾“å…¥**: "å¸®æˆ‘æ£€æŸ¥åº”ç”¨çš„é«˜å¯ç”¨é…ç½®ï¼Œç»™å‡ºæ”¹è¿›å»ºè®®"

**LLMéœ€è¦çš„å·¥å…·é“¾**:
1. æ£€æŸ¥å‰¯æœ¬æ•°å’Œåˆ†å¸ƒç­–ç•¥
2. åˆ†æPodåäº²å’Œæ€§é…ç½®
3. æ£€æŸ¥PodDisruptionBudget
4. éªŒè¯å¥åº·æ£€æŸ¥é…ç½®
5. åˆ†æèµ„æºé™åˆ¶è®¾ç½®
6. ç”Ÿæˆé«˜å¯ç”¨æŠ¥å‘Š

**éœ€è¦æ–°å¢çš„å·¥å…·**:
- âœ¨ `analyze_high_availability` - é«˜å¯ç”¨æ€§åˆ†æ
- âœ¨ `check_pod_distribution` - Podåˆ†å¸ƒæ£€æŸ¥
- âœ¨ `recommend_anti_affinity` - åäº²å’Œæ€§å»ºè®®
- âœ¨ `validate_probe_configuration` - æ¢é’ˆé…ç½®éªŒè¯

---

## ä¸‰ã€å·¥å…·è®¾è®¡åŸåˆ™ (Design Principles)

### 3.1 å®‰å…¨åŸåˆ™
1. **åªè¯»ä¼˜å…ˆ**: è¯Šæ–­å·¥å…·åªè¯»ï¼Œæ“ä½œå·¥å…·éœ€è¦æ˜ç¡®ç¡®è®¤
2. **æ“ä½œé™åˆ¶**: å±é™©æ“ä½œï¼ˆåˆ é™¤ã€æ‰©å®¹ï¼‰éœ€è¦éªŒè¯å’Œå®¡è®¡
3. **å›æ»šä¿æŠ¤**: æ‰€æœ‰å˜æ›´æ“ä½œå¿…é¡»æ”¯æŒå›æ»š
4. **æƒé™æ£€æŸ¥**: è°ƒç”¨å‰éªŒè¯RBACæƒé™

### 3.2 å¯è§‚æµ‹æ€§åŸåˆ™
1. **æ—¥å¿—è®°å½•**: æ‰€æœ‰å·¥å…·è°ƒç”¨ç»Ÿä¸€è®°å½•æ—¥å¿—ï¼ˆä½¿ç”¨ä»“åº“æ—¥å¿—æ¥å£ï¼‰
2. **å…³é”®æŒ‡æ ‡**: é‡è¦æ“ä½œè®°å½•è€—æ—¶å’Œç»“æœ
3. **é”™è¯¯å¤„ç†**: å¼‚å¸¸å¿…é¡»å¸¦ä¸Šä¸‹æ–‡ï¼ˆnamespaceã€èµ„æºåã€æ“ä½œç±»å‹ï¼‰

### 3.3 Agentå‹å¥½æ€§åŸåˆ™
1. **ç»“æ„åŒ–è¾“å‡º**: è¿”å›JSONæ ¼å¼ï¼Œä¾¿äºLLMè§£æ
2. **è¯­ä¹‰æ¸…æ™°**: å·¥å…·åç§°å’Œå‚æ•°è¯´æ˜è¦è‡ªè§£é‡Š
3. **ä¸Šä¸‹æ–‡ä¼ é€’**: æ”¯æŒRunnableConfigä¼ é€’ä¸Šä¸‹æ–‡
4. **åˆ†æ­¥æ‰§è¡Œ**: å¤æ‚æµç¨‹æ‹†åˆ†ä¸ºå¯ç»„åˆçš„åŸå­æ“ä½œ

---

## å››ã€ä¸Agentèƒ½åŠ›åŒ¹é… (Agent Capability Alignment)

### 4.1 ReAct Agent é€‚ç”¨åœºæ™¯
ReAct Agenté€‚åˆ**çº¿æ€§æ¨ç†+å·¥å…·è°ƒç”¨**çš„åœºæ™¯ï¼š

**é€‚ç”¨å·¥å…·ç±»å‹**:
- âœ… å•æ­¥è¯Šæ–­å·¥å…·ï¼ˆæŸ¥çœ‹çŠ¶æ€ã€è·å–æ—¥å¿—ï¼‰
- âœ… ç®€å•æ“ä½œå·¥å…·ï¼ˆé‡å¯Podã€æ‰©å®¹ï¼‰
- âœ… å¿«é€ŸæŸ¥è¯¢å·¥å…·ï¼ˆèµ„æºåˆ—è¡¨ã€é…ç½®æ£€æŸ¥ï¼‰

**ç¤ºä¾‹åœºæ™¯**:
```
ç”¨æˆ·: "å¸®æˆ‘é‡å¯defaultå‘½åç©ºé—´ä¸‹çš„nginx-pod"

ReActæ¨ç†:
Thought: æˆ‘éœ€è¦å…ˆç¡®è®¤Podå­˜åœ¨ï¼Œå†æ‰§è¡Œé‡å¯
Action: list_kubernetes_pods(namespace="default")
Observation: [æ‰¾åˆ°nginx-podï¼ŒçŠ¶æ€ä¸ºCrashLoopBackOff]
Thought: Podç¡®å®å­˜åœ¨ä¸”æœ‰é—®é¢˜ï¼Œå¯ä»¥é‡å¯
Action: restart_pod(namespace="default", pod_name="nginx-pod")
Observation: [Podå·²åˆ é™¤ï¼Œæ–°Podæ­£åœ¨åˆ›å»º]
Thought: éœ€è¦ç­‰å¾…æ–°Podå°±ç»ª
Action: wait_for_pod_ready(namespace="default", pod_name="nginx-pod", timeout=60)
Observation: [Podå·²å°±ç»ª]
Answer: å·²æˆåŠŸé‡å¯nginx-podï¼Œå½“å‰çŠ¶æ€ä¸ºRunning
```

### 4.2 Plan and Execute Agent é€‚ç”¨åœºæ™¯
Plan and Execute Agenté€‚åˆ**å¤æ‚ä»»åŠ¡è§„åˆ’+åˆ†æ­¥æ‰§è¡Œ**çš„åœºæ™¯ï¼š

**é€‚ç”¨å·¥å…·ç±»å‹**:
- âœ… ç»¼åˆåˆ†æå·¥å…·ï¼ˆæ€§èƒ½åˆ†æã€å®‰å…¨å®¡è®¡ï¼‰
- âœ… å¤šæ­¥éª¤æ“ä½œï¼ˆå‘å¸ƒå›æ»šã€æ•…éšœæ¢å¤ï¼‰
- âœ… éœ€è¦å†³ç­–çš„åœºæ™¯ï¼ˆä¼˜åŒ–å»ºè®®ã€å®¹é‡è§„åˆ’ï¼‰

**ç¤ºä¾‹åœºæ™¯**:
```
ç”¨æˆ·: "æˆ‘çš„åº”ç”¨æ— æ³•è®¿é—®ï¼Œå¸®æˆ‘æ’æŸ¥å¹¶ä¿®å¤"

Plané˜¶æ®µ:
æ­¥éª¤1: è¯†åˆ«åº”ç”¨ç›¸å…³èµ„æºï¼ˆPodã€Serviceã€Ingressï¼‰
æ­¥éª¤2: æ£€æŸ¥æœåŠ¡è°ƒç”¨é“¾å¥åº·çŠ¶æ€
æ­¥éª¤3: åˆ†æPodæ—¥å¿—å’Œäº‹ä»¶
æ­¥éª¤4: æ ¹æ®è¯Šæ–­ç»“æœæ‰§è¡Œä¿®å¤æ“ä½œ
æ­¥éª¤5: éªŒè¯ä¿®å¤æ•ˆæœ

Executeé˜¶æ®µ:
- æ‰§è¡Œæ­¥éª¤1: kubectl_get_resources + trace_service_chain
- æ‰§è¡Œæ­¥éª¤2: analyze_network_path + check_kubernetes_endpoints
- æ‰§è¡Œæ­¥éª¤3: get_kubernetes_pod_logs + diagnose_kubernetes_pod_issues
- æ‰§è¡Œæ­¥éª¤4: restart_pod (if needed) æˆ– scale_deployment
- æ‰§è¡Œæ­¥éª¤5: å†æ¬¡æ£€æŸ¥æœåŠ¡çŠ¶æ€

Replan (if needed): å¦‚æœä¿®å¤å¤±è´¥ï¼Œé‡æ–°è§„åˆ’è¯Šæ–­è·¯å¾„
```

---

## äº”ã€ä¼˜å…ˆçº§æ’åº (Priority Ranking)

åŸºäº**åœºæ™¯é¢‘ç‡**å’Œ**ä»·å€¼å½±å“**ï¼Œå»ºè®®çš„å®ç°ä¼˜å…ˆçº§ï¼š

### P0 (ç«‹å³å®ç°) - æ•…éšœè¯Šæ–­å¢å¼º
1. `trace_service_chain` - æœåŠ¡é“¾è·¯è¿½è¸ª
2. `analyze_pod_restart_pattern` - Podé‡å¯åˆ†æ
3. `get_resource_events_timeline` - äº‹ä»¶æ—¶é—´çº¿
4. `check_oom_events` - OOMæ£€æµ‹

### P1 (è¿‘æœŸå®ç°) - æ•…éšœè‡ªæ„ˆåŸºç¡€
5. `restart_pod` - é‡å¯Pod
6. `scale_deployment` - æ‰©ç¼©å®¹
7. `rollback_deployment` - å›æ»š
8. `get_deployment_revision_history` - å‘å¸ƒå†å²

### P2 (ä¸­æœŸå®ç°) - é…ç½®ä¼˜åŒ–
9. `analyze_resource_waste` - èµ„æºæµªè´¹åˆ†æ
10. `audit_security_policies` - å®‰å…¨å®¡è®¡
11. `analyze_high_availability` - é«˜å¯ç”¨åˆ†æ
12. `recommend_resource_right_sizing` - å®¹é‡å»ºè®®

### P3 (é•¿æœŸå®ç°) - é«˜çº§èƒ½åŠ›
13. `analyze_cluster_performance` - é›†ç¾¤æ€§èƒ½åˆ†æ
14. `scan_image_vulnerabilities` - é•œåƒæ‰«æï¼ˆéœ€é›†æˆå¤–éƒ¨å·¥å…·ï¼‰
15. `calculate_cost_savings` - æˆæœ¬åˆ†æ

---

## å…­ã€å®ç°å»ºè®® (Implementation Recommendations)

### 6.1 æ–‡ä»¶ç»„ç»‡
å»ºè®®æ–°å¢ä»¥ä¸‹æ¨¡å—ï¼š
```
neco/llm/tools/kubernetes/
â”œâ”€â”€ remediation.py      # æ•…éšœè‡ªæ„ˆå·¥å…·ï¼ˆé‡å¯ã€æ‰©å®¹ã€å›æ»šï¼‰
â”œâ”€â”€ tracing.py          # é“¾è·¯è¿½è¸ªå’Œå…³è”åˆ†æ
â”œâ”€â”€ optimization.py     # é…ç½®ä¼˜åŒ–å»ºè®®
â”œâ”€â”€ security.py         # å®‰å…¨å®¡è®¡å·¥å…·
â””â”€â”€ performance.py      # æ€§èƒ½åˆ†æå·¥å…·
```

### 6.2 å®‰å…¨çº¦æŸ
åœ¨æ“ä½œç±»å·¥å…·ä¸­å¢åŠ ï¼š
```python
def _require_confirmation(operation: str, target: str) -> bool:
    """å±é™©æ“ä½œéœ€è¦ç¡®è®¤"""
    # è®°å½•æ“ä½œåˆ°å®¡è®¡æ—¥å¿—
    logger.warning(f"å±é™©æ“ä½œ: {operation} on {target}")
    # è¿”å›æ˜¯å¦å…è®¸æ“ä½œï¼ˆå¯é›†æˆå®¡æ‰¹æµç¨‹ï¼‰
    return True

def _validate_permissions(namespace: str, resource_type: str, verb: str):
    """éªŒè¯RBACæƒé™"""
    # é€šè¿‡SelfSubjectAccessReviewæ£€æŸ¥æƒé™
    pass
```

### 6.3 å¤ç”¨ç°æœ‰å·¥å…·
æ–°å·¥å…·åº”æœ€å¤§åŒ–å¤ç”¨ç°æœ‰åŸºç¡€èƒ½åŠ›ï¼š
- ä½¿ç”¨ `kubectl_get_resources` ä½œä¸ºæŸ¥è¯¢åŸºç¡€
- ä½¿ç”¨ `diagnose_kubernetes_pod_issues` çš„è¯Šæ–­é€»è¾‘
- ä½¿ç”¨ `analyze_deployment_configurations` çš„åˆ†ææ¡†æ¶

### 6.4 æµ‹è¯•ç­–ç•¥
- å•å…ƒæµ‹è¯•ï¼šMock K8S APIå“åº”
- é›†æˆæµ‹è¯•ï¼šä½¿ç”¨kind/minikubeæ­å»ºæµ‹è¯•é›†ç¾¤
- Agentæµ‹è¯•ï¼šæ„é€ åœºæ™¯ç”¨ä¾‹æµ‹è¯•å·¥å…·é“¾

---

## ä¸ƒã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨ (Next Steps)

### Phase 1: åŸºç¡€è¯Šæ–­å¢å¼º (æœ¬å‘¨)
- [ ] å®ç° `trace_service_chain`
- [ ] å®ç° `analyze_pod_restart_pattern`
- [ ] å®ç° `get_resource_events_timeline`

### Phase 2: è‡ªæ„ˆèƒ½åŠ›æ„å»º (ä¸‹å‘¨)
- [ ] å®ç° `restart_pod` + å®‰å…¨æ£€æŸ¥
- [ ] å®ç° `scale_deployment` + å®¹é‡éªŒè¯
- [ ] å®ç° `rollback_deployment` + ç‰ˆæœ¬ç®¡ç†

### Phase 3: ä¼˜åŒ–å»ºè®®ä½“ç³» (ä¸¤å‘¨å)
- [ ] å®ç° `analyze_resource_waste`
- [ ] å®ç° `audit_security_policies`
- [ ] æ„å»ºä¼˜åŒ–å»ºè®®ç”Ÿæˆå™¨

---

## å…«ã€é£é™©å’Œæ³¨æ„äº‹é¡¹ (Risks & Considerations)

### æŠ€æœ¯é£é™©
- âš ï¸ **æƒé™é—®é¢˜**: ç¡®ä¿ServiceAccountæœ‰è¶³å¤Ÿæƒé™
- âš ï¸ **APIå…¼å®¹æ€§**: ä¸åŒK8Sç‰ˆæœ¬APIå¯èƒ½ä¸åŒï¼ˆå·²å¤„ç†v1/v1beta1ï¼‰
- âš ï¸ **æ€§èƒ½å½±å“**: é¢‘ç¹è°ƒç”¨APIå¯èƒ½è§¦å‘é™æµ

### ä¸šåŠ¡é£é™©
- âš ï¸ **è¯¯æ“ä½œé£é™©**: è‡ªæ„ˆå·¥å…·å¯èƒ½è¯¯åˆ èµ„æºï¼Œéœ€è¦ä¸¥æ ¼éªŒè¯
- âš ï¸ **å®‰å…¨é£é™©**: LLMç”Ÿæˆçš„æ“ä½œå‘½ä»¤éœ€è¦æ²™ç®±éš”ç¦»
- âš ï¸ **å®¡è®¡åˆè§„**: æ‰€æœ‰æ“ä½œéœ€è¦å®Œæ•´çš„å®¡è®¡æ—¥å¿—

### ç¼“è§£æªæ–½
1. **æ“ä½œå‰éªŒè¯**: æ‰€æœ‰å˜æ›´æ“ä½œéœ€è¦pre-flight check
2. **åªè¯»æ¨¡å¼**: é»˜è®¤åªæä¾›è¯Šæ–­å·¥å…·ï¼Œæ“ä½œå·¥å…·éœ€æ˜¾å¼å¯ç”¨
3. **æ“ä½œå®¡æ‰¹**: å…³é”®æ“ä½œé›†æˆå®¡æ‰¹æµç¨‹
4. **å›æ»šæœºåˆ¶**: æ‰€æœ‰æ“ä½œè®°å½•å˜æ›´å‰çŠ¶æ€ï¼Œæ”¯æŒä¸€é”®å›æ»š

---

**è®¾è®¡è´Ÿè´£äºº**: GitHub Copilot  
**å®¡æ ¸çŠ¶æ€**: å¾…è¯„å®¡  
**æ›´æ–°æ—¶é—´**: 2025-10-21
