GitHub Copilot Instructions

1. 基本原则
	•	避免臆测：缺失信息时，优先在仓库内搜索，复用既有模式。
	•	最小改动：能扩展不分叉，能配置不硬编码。
	•	增量交付：每次提交应为最小可运行单元，避免过度设计。
	•	渐进迭代：在不确定情况下，优先小步快跑，并明确边界。

⸻

2. 编码规范
	•	遵循 PEP 8；公共接口与复杂逻辑必须提供 类型注解。
	•	Docstring：保持与项目既有风格一致，必要时说明输入、输出和边界条件。
	•	命名：避免拼音或模糊缩写，保持语义清晰。
	•	可读性优先：相较于微优化，更注重逻辑简洁与清晰；鼓励早返回，减少嵌套分支。
	•	性能监测：性能敏感代码需使用内置装饰器标记：

from src.core.sanic_plus.utils.timing_decorator import timeit

@timeit("operation_name")
async def handler(...):
    ...

⸻

3. 日志与错误处理
	•	日志接口：统一使用
from sanic.log import logger

	•	日志位置：入口、外部调用、异常处理、状态变更。
	•	安全要求：禁止打印敏感信息；参数仅输出概要（掩码或哈希）。
	•	异常管理：不得吞掉异常；顶层捕获必须输出上下文信息。

⸻

4. 依赖与配置
	•	依赖管理：仅允许使用 requirements/ 中列出的依赖。
	•	新依赖：必须在 PR 中说明用途与必要性。
	•	配置管理：统一使用环境变量，并在 .env.example 中提供示例。
	•	安全约束：禁止在仓库中包含默认密钥或敏感配置。
	•	运行环境：项目使用虚拟环境，路径为 ./.venv/。

⸻

5. Sanic 框架规范
	•	I/O 操作：所有外部调用必须为 async，并设置 超时与取消机制。
	•	并发控制：使用 asyncio.Semaphore 管理并发。
	•	请求处理：入口参数统一使用 Pydantic 校验。

⸻

6. 性能与安全要求
	•	外部调用：必须实现超时与指数退避重试机制。
	•	CPU 密集型任务：需交由后台任务或队列执行，禁止阻塞事件循环。
	•	输入输出安全：输入必须校验，输出需编码，避免注入和目录遍历。
	•	密钥管理：Secrets 必须通过环境变量或专用密钥管理系统。
	•	鉴权：统一由中间件实现，遵循最小权限原则，并支持令牌过期刷新。

⸻

7. 交付要求

所有改动必须满足以下标准：
	•	可读性：代码清晰、符合规范，便于理解。
	•	可测试性：具备充分的单元测试或集成测试条件。
	•	可回滚性：变更边界明确，易于撤销。
	•	可观测性：关键路径具备日志与监控。