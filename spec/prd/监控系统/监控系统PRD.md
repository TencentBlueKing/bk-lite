# 监控系统 PRD（Monitor /monitor）

- 文档日期：2026-02-27
- 文档版本：v1.1
- 适用范围：BK-Lite Web 端监控模块（`/monitor`）
- 原则：若官网文档与项目实现冲突，以当前代码实现为准

---

## 1. 产品背景与目标

### 1.1 背景
监控系统是运维观测主入口，承接“采集接入 -> 资源观测 -> 异常告警 -> 处置复盘”的闭环。官网文档对模块能力有完整目录描述，但部分章节（如 Data Explorer）细节缺失；本 PRD 以代码事实为主，统一产品口径，支撑研发、测试与验收。

### 1.2 目标（本期）
1. 建立统一监控工作台，覆盖 View / Search / Event / Integration 四域能力。
2. 实现从实例指标到告警事件再到策略治理的闭环操作。
3. 明确事件状态、等级、无数据告警、自动恢复等核心规则。
4. 给出可执行验收标准，避免“文档有、代码无”或“代码有、文档缺”偏差。

### 1.3 成功标准
- 用户可完成“接入资源 -> 查看指标 -> 配置策略 -> 处理告警 -> 历史复盘”的全流程。
- 监控事件和告警状态可解释、可追踪、可关闭/恢复。
- 指标检索支持多条件检索、图表/表格查看、时间范围与刷新周期。
- 关键能力可映射到已有页面和 API，不依赖新建模块。

---

## 2. 范围定义

### 2.1 In Scope（本期纳入）
仅包含 Web 监控模块 `/monitor`：

1. **View（视图）**
   - 全局资源列表
   - 实例详情（指标与关联信息）
   - 专属仪表盘入口

2. **Search（搜索 / Data Explorer）**
   - 监控对象、指标、实例、维度条件检索
   - 折线图/表格双视图
   - 时间范围、步长、自定义刷新

3. **Event（事件）**
   - 告警管理（活跃/历史）
   - 策略管理（列表 + 向导式创建/编辑）
   - 模板管理（策略模板复用）

4. **Integration（集成）**
   - 采集插件/模板接入
   - 资产管理
   - 分组规则管理

### 2.2 Out of Scope（本期不纳入）
1. 独立告警平台 `/alarm` 的事故、分派、屏蔽、系统设置等能力。
2. Mobile 端完整监控功能建设（当前仅工作台“监控告警”入口）。
3. 新增采集引擎或跨租户复杂治理流程。

---

## 3. 用户与核心场景

### 3.1 目标用户
- 运维工程师：日常巡检、异常定位、策略调优。
- 平台管理员：监控对象接入、组织规则治理、模板沉淀。

### 3.2 核心场景
1. **接入新资源并验证采集**：通过 Integration 接入插件并查看资产上报状态。
2. **异常发现与处置**：在 Event 中查看活跃告警、查看详情、关闭告警。
3. **策略精细化治理**：配置阈值/无数据规则、设置恢复条件与通知方式。
4. **指标深度分析**：在 Search 按对象与维度检索指标，切换图表/表格分析趋势。

---

## 4. 信息架构

### 4.1 一级导航
- View
- Search
- Event（Alert / Strategy / Template）
- Integration（List / Asset / Group）

### 4.2 核心对象
- 监控对象（Monitor Object）
- 监控实例（Monitor Instance）
- 指标与指标分组（Metric / Metric Group）
- 监控策略（Monitor Policy）
- 监控事件（Monitor Event）
- 监控告警（Monitor Alert）
- 监控插件（Monitor Plugin）

---

## 5. 功能需求

## 5.1 View（视图）

### 5.1.1 全局资源列表
- 支持按对象类型/分类筛选资源。
- 列表展示资源基础状态、关键资源信息、上报相关信息。
- 支持进入实例详情、仪表盘等快捷入口。

### 5.1.2 实例详情
- 展示实例维度的指标趋势与结构化信息。
- 可关联查看该实例相关告警信息（与 Event 数据一致）。

### 5.1.3 专属仪表盘
- 提供实例全量指标可视化入口。
- 支持按指标分组与时间范围查看趋势。

---

## 5.2 Search（指标检索 / Data Explorer）

### 5.2.1 检索条件
- 必填：监控对象、指标、实例。
- 可选：维度条件（支持多条条件组合）。
- 支持 URL 参数预置（对象、指标、实例）。

### 5.2.2 结果展示
- 图表视图：折线图呈现趋势。
- 表格视图：明细数据展示并支持列结构。
- 支持单位转换与展示。

### 5.2.3 时间与刷新
- 支持最近时间快捷选择与自定义时间范围。
- 根据时间范围自动计算查询步长。
- 支持设置自动刷新频率并轮询更新。

---

## 5.3 Event（事件）

### 5.3.1 告警管理
- 支持“活跃告警 / 历史告警”标签切换。
- 支持级别、状态、时间范围、对象类型等筛选。
- 支持告警详情查看与关闭操作（权限控制下）。
- 支持告警趋势可视化（分布图）。

### 5.3.2 策略管理
- 列表能力：新增、编辑、删除、启停。
- 向导能力：4 步完成策略配置：
  1) 基本信息（策略名、告警名、组织、监控目标、周期）
  2) 指标定义（插件/采集类型、指标、分组、过滤、汇聚）
  3) 告警条件（阈值告警、无数据告警、自动恢复）
  4) 通知配置（通知开关、通知方式、通知人）

### 5.3.3 告警名称模板变量（策略配置）
- 告警名称模板可选变量为：`${monitor_object}`、`${resource_name}`、`${level}`、`${metric_name}`、`${value}`、`${dimension_value}`。
- 其中，`resource_name`固定为实例名称（不含维度），`dimension_value`固定为`维度名称:维度值`并以英文逗号分隔。

### 5.3.4 模板管理
- 支持策略模板展示与复用。
- 支持基于模板快速生成策略配置。

---

## 5.4 Integration（集成）

### 5.4.1 集成列表
- 展示可接入监控插件/模板。
- 支持按对象分类筛选、关键字检索。
- 支持插件配置导入/导出与详情配置入口。

### 5.4.2 资产管理
- 展示已接入资产列表及基础信息。
- 支持资产编辑、配置调整、删除等生命周期操作。

### 5.4.3 分组管理
- 支持按规则创建资源逻辑分组。
- 支持分组规则新增、编辑、删除。
- 分组结果可用于后续批量策略关联与观测分析。

---

## 6. 关键产品规则（以代码为准）

### 6.1 告警类型
- `threshold`：阈值告警
- `no_data`：无数据告警

### 6.2 告警等级
- 事件等级：`no_data` / `info` / `warning` / `error` / `critical`
- 等级权重：`warning < error < critical < no_data`

### 6.3 告警状态
- `new`：活跃告警（未关闭）
- `closed`：人工关闭
- `recovered`：自动恢复

### 6.4 策略执行规则
- 策略支持启停；启用后按 `schedule` 周期扫描。
- 扫描时按策略 source 过滤实例（实例/组织维度）。
- 可同时启用阈值告警与无数据告警。
- 满足恢复条件时执行自动恢复。
- 若开启通知，事件生成后触发通知发送。

### 6.5 数据基准与快照
- 策略实例基准用于无数据检测。
- 告警生命周期内记录指标快照，支撑复盘。

### 6.6 告警名称变量渲染规则
- 告警名称渲染中，`resource_name`固定为实例名称（不含维度），`dimension_value`固定为按分组维度顺序输出的`维度名称:维度值`并以英文逗号分隔（无维度时为空字符串）。

---

## 7. 核心业务流程

### 7.1 接入到观测
1) 在 Integration 选择插件并完成接入配置。
2) 资产生成并开始上报监控数据。
3) 在 View / Search 查看实例状态与指标趋势。

### 7.2 策略到告警
1) 在 Event-Strategy 创建并启用策略。
2) 扫描任务按周期查询指标并检测阈值/无数据异常。
3) 生成事件与告警，必要时发送通知。

### 7.3 告警处置与复盘
1) 在 Event-Alert 查看活跃告警并进行关闭。
2) 自动恢复或手动关闭后进入历史告警。
3) 基于历史记录、快照与趋势完成故障复盘。

---

## 8. 代码与官网差异处理

1. **Data Explorer 章节差异**
   - 官网：该章节标注“暂未补充详细功能说明”。
   - 代码：Search 页面已具备对象/指标/实例检索、图表/表格、时间与自动刷新能力。
   - 本 PRD 结论：按代码现状详写 Search 能力。

2. **告警术语差异**
   - 官网文案常用“严重/预警、活跃/历史”。
   - 代码状态与等级使用英文枚举（`new/closed/recovered`、`critical/error/warning/info/no_data`）。
   - 本 PRD 结论：规则定义使用代码枚举，页面文案可做中英文映射。

3. **监控与告警平台边界**
   - 代码存在 `/monitor` 与 `/alerts` 两套体系。
   - 本 PRD 结论：仅覆盖 `/monitor`，不混入 `/alerts`。

---

## 9. 非功能需求

1. **性能与实时性**
   - 支持按刷新周期轮询更新，避免重复并发请求。
   - 搜索与告警查询具备分页/筛选能力，保障大数据量可用性。

2. **权限与安全**
   - 告警关闭等敏感操作按权限点控制。
   - 通知配置与组织范围遵循策略归属约束。

3. **可维护性**
   - 策略、事件、告警、插件实体关系清晰，便于后续扩展。

---

## 10. 分阶段规划（渐进式）

### M1：监控闭环可用（优先）
- View + Search + Event-Alert 基础能力打通。
- 验收：可完成“看指标、看告警、关闭告警”。

### M2：策略治理增强
- Event-Strategy 四步向导完整可用，阈值+无数据+恢复规则可执行。
- 验收：可稳定生成并恢复告警，通知链路可达。

### M3：接入与规模化管理
- Integration（集成/资产/分组）能力完善。
- 验收：新对象可接入、可管理、可分组并可用于策略配置。

---

## 11. 验收清单

1. **导航与页面**
   - `/monitor` 下四大域页面可访问，子页路由可用。

2. **View**
   - 可按对象筛选资源并进入详情。

3. **Search**
   - 可按对象+指标+实例查询，图表/表格可切换，支持时间范围与自动刷新。

4. **Event-Alert**
   - 活跃/历史告警可筛选、可查看详情、可关闭活跃告警。

5. **Event-Strategy**
   - 支持新增/编辑/删除/启停；向导 4 步可完成策略创建并生效。

6. **Event-Template**
   - 模板可查看并复用生成策略。

7. **Integration**
   - 插件可筛选与配置，资产可管理，分组规则可维护。

8. **规则一致性**
   - 告警类型、等级、状态与自动恢复行为符合代码定义。

---

## 12. 风险与应对

1. **模块边界混淆风险（monitor vs alerts）**
   - 应对：PRD 与验收仅使用 `/monitor` 范围及术语。

2. **官网与实现不一致风险**
   - 应对：固定“代码优先”原则，并设置差异对照章节。

3. **策略配置复杂度风险**
   - 应对：四步向导拆解复杂参数，默认值与模板降低门槛。

---

## 13. TODO（待确认项）

- TODO: Search 页中的维度条件组合逻辑（AND/OR 细粒度行为）需在接口层补充说明。
- TODO: 模板来源与版本治理策略（内置模板更新机制）需产品与后端联合确认。
- TODO: 通知渠道的最终能力边界（邮件/企业微信等）需与系统通知模块对齐。

---

## 14. 结论

本 PRD 以代码实现为唯一事实基线，完整覆盖监控模块 `/monitor` 的 View、Search、Event、Integration 四域能力，形成可执行、可验证、可迭代的产品定义；对官网与代码差异已明确处理策略，可直接用于研发排期与测试验收。