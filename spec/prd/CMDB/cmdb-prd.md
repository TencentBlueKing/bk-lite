# CMDB 产品PRD

版本：v1.0

日期：2026-02-27

## 1. 背景与目标

CMDB 是资产与配置数据的统一管理中心，围绕“模型驱动的资产管理”与“自动发现采集”两条主线，提供资产建模、实例维护、关系管理、检索与变更追踪能力。

目标：
- 统一资产模型定义与关系约束，降低资产管理成本。
- 支撑资产实例全生命周期管理与可追溯变更记录。
- 通过自动发现提升数据采集效率与准确性。

## 2. 目标用户与使用场景

- 资产管理员：负责模型配置、字段分组、资产结构维护。
- 运维工程师：维护资产实例、关联关系、搜索与排障。
- 平台管理员：管理自动发现任务、采集插件与 SOID 库。

## 3. 本期范围与后续规划

本期范围：
- 模型管理：模型分类、模型、属性、字段分组、模型关系。
- 资产管理：资产实例增删改查、批量导入、批量导出、资产关联、详情查看。
- 资产视图：按模型/分类汇总与快速跳转。
- 资产检索：全文检索、按模型统计与分页查看。
- 自动发现：采集对象树、采集任务管理、采集插件说明、SOID 库。
- 变更记录：变更日志与时间筛选。
- 个人配置：展示字段与用户保存的筛选条件。

后续规划（不在本期落地）：
- 更细粒度的权限矩阵与角色配置。
- 自动发现结果的高级审批流扩展与可配置流程。
- 跨模块联动的资产变更通知与工作流编排。

## 4. 需求总览

- 模型管理
- 资产管理
- 资产视图
- 资产检索
- 自动发现与采集任务
- SOID 特征库
- 变更记录
- 个人配置

## 5. 功能需求

### 5.1 模型管理

- 模型分类管理：新增、修改、删除、列表展示。
- 模型管理：新增、修改、删除、复制、列表与详情。
- 属性管理：新增与配置模型属性，内置默认属性 `inst_name` 与 `organization`。
- 字段分组：可创建/编辑/删除字段分组，支持分组排序与折叠状态。
- 关系管理：定义模型间关联关系，支持关联类型与映射约束。

### 5.2 资产管理

- 资产实例：
  - 列表查询支持筛选、分页、排序。
  - 实例新增、修改、删除（含批量操作）。
  - 支持导入与导出（Excel）。
- 资产关联：
  - 创建/取消资产间关联关系。
  - 支持按关联类型查看与管理。
- 资产详情：
  - 查看基础属性、关联关系与变更记录。
  - 支持拓扑视图展示（按层展开）。

### 5.3 资产视图

- 按模型分类展示资产概览卡片。
- 支持关键字搜索并快速跳转到对应资产列表页。

### 5.4 资产检索

- 全文检索：输入关键字检索资产实例。
- 搜索结果：按模型分组统计与分页展示。
- 支持大小写敏感配置与搜索历史保存。

### 5.5 自动发现与采集任务

- 采集对象树：按类型展示可采集对象与标签。
- 采集任务管理：新增、编辑、删除、列表与详情。
- 采集任务配置：支持周期执行、接入点、凭据与超时设置。
- 采集结果摘要：支持新增/更新/删除/关联的分类数据摘要。
- 采集文档：按采集对象查看对应的插件说明文档。

### 5.6 SOID 特征库

- 维护设备 `sysObjectID` 映射关系。
- 支持新增、编辑、删除、列表展示。

### 5.7 变更记录

- 变更日志列表与详情查看。
- 支持按时间范围筛选与按类型展示。

### 5.8 个人配置

- 用户级别的展示字段配置（ShowField）。
- 用户保存的筛选条件（UserPersonalConfig）。

## 6. 关键业务流程（摘要）

- 模型新增与配置：创建分类 → 新增模型 → 配置属性与字段分组 → 设置关系。
- 资产新增与维护：选择模型 → 新增实例 → 编辑/导入 → 维护关联关系。
- 资产检索：输入关键字 → 查看模型统计 → 按模型查看详情。
- 自动发现：选择采集对象 → 配置任务 → 执行采集 → 查看采集摘要。

## 7. 数据结构与字段字典

### 7.1 模型与实例默认属性

- `inst_name`：实例名（唯一、必填、可编辑）。
- `organization`：所属组织（必填、可编辑）。

### 7.2 属性类型

- 字符串：`str`
- 整数：`int`
- 枚举：`enum`
- 时间：`time`
- 用户：`user`
- 组织：`organization`
- 布尔：`bool`
- 密码：`pwd`

### 7.3 属性约束

- `is_only`：唯一
- `is_required`：必填
- `editable`：可编辑

### 7.4 关联类型

- `belong`（属于）
- `group`（组成）
- `run`（运行于）
- `install_on`（安装于）
- `contains`（包含）
- `connect`（关联）

### 7.5 关联映射约束

- `1:1`：一对一
- `1:n`：一对多
- `n:1`：多对一
- `n:n`：多对多

### 7.6 自动发现采集类型

采集插件类型：
- `vm`、`snmp`、`k8s`、`cloud`、`protocol`、`host`、`db`、`middleware`、`ip`、`other`

采集驱动类型：
- `protocol`（协议采集）
- `job`（脚本采集）

采集对象树（示例范围，实际以配置为准）：
- 容器（K8S、Docker）
- VMware（vCenter）
- 网络设备（SNMP）
- 数据库（MySQL、PostgreSQL、Redis）
- 云平台（阿里云、腾讯云）
- 主机（主机、物理服务器）
- 中间件（Nginx、Zookeeper、Kafka、Consul、Etcd、RabbitMQ、Tomcat）

### 7.7 采集任务核心字段（摘要）

- `name`：任务名称
- `task_type`：任务类型
- `driver_type`：驱动类型
- `model_id`：模型ID
- `is_interval`、`scan_cycle`：周期配置
- `access_point`：接入点
- `credential`：凭据（加密存储）
- `timeout`：单对象超时
- `exec_status`、`exec_time`：执行状态与时间
- `format_data`：采集摘要数据（新增/更新/删除/关联）

### 7.8 SOID 映射字段（摘要）

- `model`：设备型号
- `oid`：设备 OID（唯一）
- `brand`：品牌
- `device_type`：设备类型
- `built_in`：是否内置

## 8. 需求优先级（MoSCoW）

- Must：模型管理、资产实例管理、资产关联、全文检索、采集任务管理、变更记录。
- Should：资产视图、批量导入导出、采集文档、SOID 库。
- Could：个人配置、字段分组排序优化、模型复制增强。
- Won’t（本期不做）：跨模块联动通知、可配置审批流。

## 9. 验收标准（按场景）

- 新增模型场景：
  - 可创建分类与模型，模型可出现在列表并可进入详情配置。
- 配置模型属性场景：
  - 新增/编辑属性后，实例新增表单与列表字段同步生效。
- 采集任务场景：
  - 可创建采集任务并配置接入点/凭据/周期/超时，任务可正常保存并出现在列表。
- 资产搜索场景：
  - 输入关键字可返回模型统计与分页列表，支持大小写敏感切换。
- 资产关联场景：
  - 可选择关联类型并创建关联关系，关联关系可在列表与拓扑中查看。
- 拓扑查看场景：
  - 资产详情页可查看拓扑结构并按层展开。
- 变更记录场景：
  - 变更日志支持查看详情与时间筛选。
- 批量导入/导出场景：
  - 可按模型导入实例数据，导出支持选字段与关联信息。


